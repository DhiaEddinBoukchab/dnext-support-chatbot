{
  "emails": [
    {
      "subject": "Re: [EXTERNAL] RE: Trade flows version",
      "from": "Roberto.Ruiz@mlp.com",
      "from_name": "Ruiz, Roberto",
      "to": "Saber Khalfallah",
      "cc": "Support Dnext",
      "received_time": "2025-06-20 18:08:46.059000+00:00",
      "sent_time": "2025-06-20 18:08:30+00:00",
      "body_text": "Many thanks for the quick response.\r\n\r\nRegards \r\n\r\n________________________________\r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io>\r\nSent: Friday, June 20, 2025 6:49 PM\r\nTo: Ruiz, Roberto <Roberto.Ruiz@mlp.com>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: [EXTERNAL] RE: Trade flows version \r\n \r\n\r\nHello Roberto,\r\n\r\n \r\n\r\nThank you for reaching out.\r\n\r\n \r\n\r\nBelow is the corrected script. I noticed that you were using the old codes for both the tradeflows and the forecasts. Kindly make sure to use the updated format: thul-xxxx-xxxx-xxxx-xxxx.\r\n\r\n \r\n\r\nQuote\r\n\r\n \r\n\r\nimport requests\r\n\r\nimport json\r\n\r\nimport base64\r\n\r\nimport pandas as pd\r\n\r\n \r\n\r\n######## get the login token ###############\r\n\r\nuser=\"user”\r\n\r\npassword=”password”\r\n\r\norg=\"thul\"\r\n\r\nurl = f'https://api.dnext.io/dev/auth/custom-login?org='+org\r\n\r\npayload = json.dumps({\r\n\r\n  \"email\": user,\r\n\r\n  \"password\": password,\r\n\r\n  \"organization\": org\r\n\r\n})\r\n\r\nheaders = {\r\n\r\n  'Content-Type': 'application/json'\r\n\r\n}\r\n\r\nresponse = requests.request(\"POST\", url, headers=headers, data=payload).json()\r\n\r\ntoken = 'Bearer ' + response['token']\r\n\r\n \r\n\r\nheaders = {\r\n\r\n  'Content-Type': 'application/json',\r\n\r\n  'Authorization': token\r\n\r\n}\r\n\r\n \r\n\r\nprint(\"token\",token)\r\n\r\n############################################\r\n\r\n##### INPUT : TRADEFLOW CODE #########\r\n\r\ntradeflow_ = 'thul-6739954d-a4f8-4436-a7bc-f57bf3b79f20'\r\n\r\nforecast_ = 'thul-01142ad-6fbb-83f-8ec4-63ebfaf0e42'\r\n\r\n######################################\r\n\r\n########## list all tradeflows to find tradeflow_id #################\r\n\r\nurl = 'https://api.dnext.io/v1.0/fundamentals/tradeflows?old_sharing=true'\r\n\r\ntf_list = requests.get(url, headers=headers).json()\r\n\r\nprint (\"tf list\",tf_list)\r\n\r\n# tf_list=pd.DataFrame(tf_list)\r\n\r\n# print (\"tf list\",tf_list)\r\n\r\n \r\n\r\n# tf_list = pd.DataFrame(tf_list)[['trade_flow']]\r\n\r\ntf_list = pd.json_normalize(tf_list['result'])\r\n\r\ntradeflow_id = tf_list[tf_list.code == tradeflow_].id.iloc[0].strip()\r\n\r\nprint(f\"Tradeflow ID: >>{tradeflow_id}<<\")\r\n\r\n \r\n\r\n###################################\r\n\r\n########### make the list of snapshot #########\r\n\r\nparams = {'deep': 'true'}\r\n\r\ndata = {\"where\":\"trade_flow_id eq \" + tradeflow_id,\"hastobe\":False}\r\n\r\nurlsnaps=url = f'https://api.dnext.io/v1.0/fundamentals/tradeflows/{tradeflow_id}/snapshots'\r\n\r\n \r\n\r\nresponse = requests.get(urlsnaps,params=params, headers=headers)\r\n\r\nprint(\"response\",response.text)\r\n\r\nsnapshot_list = pd.DataFrame(response.json()[\"result\"])\r\n\r\n \r\n\r\nsnapshot_list = snapshot_list[['table_name', 'created_at']].copy()\r\n\r\n##############################\r\n\r\n####### INPUT : CHOOSE THE SNAPSHOT FROM ABOVE LIST ########\r\n\r\nsnapshot_ = 'dnexr-crn-20231011120944'\r\n\r\n###############################\r\n\r\n################# download the data\r\n\r\nurl = 'https://api.dnext.io/fundamentals/tradeflow/compare'\r\n\r\npayload = json.dumps({\r\n\r\n  \"code\": tradeflow_,\r\n\r\n  \"from\": snapshot_,\r\n\r\n  \"to\": None,\r\n\r\n  \"forecastsFrom\": [\r\n\r\n    forecast_\r\n\r\n  ],\r\n\r\n  \"forecastsTo\": [\r\n\r\n    forecast_\r\n\r\n  ],\r\n\r\n  \"startMonth\": 9\r\n\r\n})\r\n\r\nurl = requests.request(\"POST\", url, headers=headers, data=payload).json()['url']\r\n\r\ndf = pd.read_json(url, lines=True)\r\n\r\ndf = df[['Date', 'Product', 'Origin', 'Destination', 'QuantityOld']].copy()\r\n\r\ndf.dropna(subset=['QuantityOld'], inplace=True)\r\n\r\n#print(df)\r\n\r\n \r\n\r\nUnquote\r\n\r\n \r\n\r\nPlease let me know how this works on your end. I'm happy to assist further if needed.\r\n\r\n \r\n\r\nLooking forward to your feedback.\r\n\r\n \r\n\r\nBest regards,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Ruiz, Roberto <Roberto.Ruiz@mlp.com>\r\nSent: Friday, June 20, 2025 16:47\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io>\r\nSubject: Trade flows version\r\n\r\n \r\n\r\nHello Saber,\r\n\r\n \r\n\r\nHope that you’re doing well.\r\n\r\nI want to compare the current corn trade flows vs a previous version. Some months ago Bastien gave me the code below that used to work for retrieving previous versions of the trade flows. Something has changed though, as this script doesn’t run as before.\r\n\r\nCould you pls let me know which code I can use to query an old version of trade flows?\r\n\r\n \r\n\r\n \r\n\r\nMany thanks\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nimport requests\r\n\r\nimport json\r\n\r\nimport base64\r\n\r\nimport pandas as pd\r\n\r\n \r\n\r\n######## get the login token ###############\r\n\r\nuser=xxxxx <mailto:roberto.ruiz@mlp.com> \r\n\r\npassword=xxx\r\n\r\norg=\"thul\"\r\n\r\nurl = f'https://api.dnext.io/dev/auth/custom-login?org='+org\r\n\r\npayload = json.dumps({\r\n\r\n  \"email\": user,\r\n\r\n  \"password\": password,\r\n\r\n  \"organization\": org\r\n\r\n})\r\n\r\nheaders = {\r\n\r\n  'Content-Type': 'application/json'\r\n\r\n}\r\n\r\nresponse = requests.request(\"POST\", url, headers=headers, data=payload).json()\r\n\r\ntoken = 'Bearer ' + response['token']\r\n\r\n \r\n\r\nheaders = {\r\n\r\n  'Content-Type': 'application/json',\r\n\r\n  'Authorization': token\r\n\r\n}\r\n\r\n \r\n\r\n \r\n\r\n############################################\r\n\r\n##### INPUT : TRADEFLOW CODE #########\r\n\r\ntradeflow_ = 'dnexr-crn'\r\n\r\nforecast_ = 'dnexr-crn'\r\n\r\n######################################\r\n\r\n########## list all tradeflows to find tradeflow_id #################\r\n\r\nurl = 'https://api.dnext.io/dnext/data_sharing/?relation=[trade_flow]'\r\n\r\ntf_list = requests.get(url, headers=headers).json()\r\n\r\n \r\n\r\ntf_list = pd.DataFrame(tf_list)[['trade_flow']]\r\n\r\ntf_list = pd.json_normalize(tf_list['trade_flow'])\r\n\r\ntradeflow_id = tf_list[tf_list.code == tradeflow_].id.iloc[0]\r\n\r\n \r\n\r\nprint(tradeflow_id)\r\n\r\n \r\n\r\n###################################\r\n\r\n########### make the list of snapshot #########\r\n\r\nparams = {'deep': 'true'}\r\n\r\ndata = {\"where\":\"trade_flow_id eq \" + tradeflow_id,\"hastobe\":False}\r\n\r\nresponse = requests.post('https://api.dnext.io/search/trade_flow_snapshot', params=params, headers=headers, json=data)\r\n\r\nsnapshot_list = pd.DataFrame(response.json())\r\n\r\nsnapshot_list = snapshot_list[['table_name', 'createdAt']].copy()\r\n\r\n##############################\r\n\r\n####### INPUT : CHOOSE THE SNAPSHOT FROM ABOVE LIST ########\r\n\r\nsnapshot_ = 'dnexr-crn-20231011120944'\r\n\r\n###############################\r\n\r\n################# download the data\r\n\r\nurl = 'https://api.dnext.io/fundamentals/tradeflow/compare'\r\n\r\npayload = json.dumps({\r\n\r\n  \"code\": tradeflow_,\r\n\r\n  \"from\": snapshot_,\r\n\r\n  \"to\": None,\r\n\r\n  \"forecastsFrom\": [\r\n\r\n    forecast_\r\n\r\n  ],\r\n\r\n  \"forecastsTo\": [\r\n\r\n    forecast_\r\n\r\n  ],\r\n\r\n  \"startMonth\": 9\r\n\r\n})\r\n\r\nurl = requests.request(\"POST\", url, headers=headers, data=payload).json()['url']\r\n\r\ndf = pd.read_json(url, lines=True)\r\n\r\ndf = df[['Date', 'Product', 'Origin', 'Destination', 'QuantityOld']].copy()\r\n\r\ndf.dropna(subset=['QuantityOld'], inplace=True)\r\n\r\n#print(df)\r\n\r\n##########################################################\r\n \r\n\r\nThe information contained in this communication is confidential and intended only for the person(s) or entity(ies) to which it is addressed. If you are not a named addressee, please notify the sender immediately, delete this email from your system and do not disclose the email or any part of it to any person. Any views or opinions expressed in this email are those of the author and do not necessarily represent the views of MCP (Switzerland) GmbH or any of its affiliates. Therefore, this communication is not intended as an offer or solicitation for the purchase or sale of any financial instrument or as an official confirmation of any transaction. \r\n\r\nElectronic communications can be insecure and can contain errors, they can be intercepted, corrupted, lost, destroyed, incomplete or may contain viruses. Neither MCP (Switzerland) GmbH, its affiliates nor the sender can accept any liability for any kind of damages as the result of viruses or transmission errors or delays. Outgoing and incoming electronic communications of MCP (Switzerland) GmbH and its affiliates, including telephone communications, may be electronically archived and subject to review and/or disclosure to someone other than the recipient.\r\n\r\nMCP (Switzerland) GmbH is a Swiss manager of collective assets authorized and regulated by the Swiss Financial Market Supervisory Authority (FINMA). MCP (Switzerland) GmbH is a limited liability company registered in Switzerland under company number CHE-216.367.660 and with its registered office at rue du Rhône 42, 1204 Geneva, Switzerland.\r\n \r\n########################################################## \r\n\r\n##########################################################\r\n \r\nThe information contained in this communication is confidential and intended only for the person(s) or entity(ies) to which it is addressed. If you are not a named addressee, please notify the sender immediately, delete this email from your system and do not disclose the email or any part of it to any person. Any views or opinions expressed in this email are those of the author and do not necessarily represent the views of MCP (Switzerland) GmbH or any of its affiliates. Therefore, this communication is not intended as an offer or solicitation for the purchase or sale of any financial instrument or as an official confirmation of any transaction. \r\n\r\nElectronic communications can be insecure and can contain errors, they can be intercepted, corrupted, lost, destroyed, incomplete or may contain viruses. Neither MCP (Switzerland) GmbH, its affiliates nor the sender can accept any liability for any kind of damages as the result of viruses or transmission errors or delays. Outgoing and incoming electronic communications of MCP (Switzerland) GmbH and its affiliates, including telephone communications, may be electronically archived and subject to review and/or disclosure to someone other than the recipient.\r\n\r\nMCP (Switzerland) GmbH is a Swiss manager of collective assets authorized and regulated by the Swiss Financial Market Supervisory Authority (FINMA). MCP (Switzerland) GmbH is a limited liability company registered in Switzerland under company number CHE-216.367.660 and with its registered office at rue du Rhône 42, 1204 Geneva, Switzerland.\r\n \r\n########################################################## ",
      "body_html": "<html><head>\r\n\r\n</head>\r\n<body>\r\n<div dir=\"ltr\">Many thanks for the quick response.</div>\r\n<div dir=\"ltr\"><br>\r\n</div>\r\n<div dir=\"ltr\" style=\"font-family: Aptos, Aptos_MSFontService, -apple-system, Roboto, Arial, Helvetica, sans-serif; font-size: 12pt;\">\r\nRegards&nbsp;</div>\r\n<div id=\"ms-outlook-mobile-body-separator-line\" dir=\"ltr\"><br>\r\n</div>\r\n<div id=\"ms-outlook-mobile-signature\" dir=\"ltr\"></div>\r\n<div id=\"mail-editor-reference-message-container\" class=\"ms-outlook-mobile-reference-message\">\r\n<div id=\"mail-editor-reference-message-container\">\r\n<hr style=\"display: inline-block; width: 98%;\">\r\n<div id=\"divRplyFwdMsg\" dir=\"ltr\"><span style=\"font-family: Calibri, sans-serif;\"><b>From:</b>&nbsp;Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;<br>\r\n<b>Sent:</b>&nbsp;Friday, June 20, 2025 6:49 PM<br>\r\n<b>To:</b>&nbsp;Ruiz, Roberto &lt;Roberto.Ruiz@mlp.com&gt;<br>\r\n<b>Cc:</b>&nbsp;Support Dnext &lt;support@dnext.io&gt;<br>\r\n<b>Subject:</b>&nbsp;[EXTERNAL] RE: Trade flows version</span>\r\n<div style=\"font-family: Calibri, sans-serif;\">&nbsp;</div>\r\n</div>\r\n<meta name=\"Generator\" content=\"Microsoft Word 15 (filtered medium)\">\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">Hello Roberto,</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">Thank you for reaching out.</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">Below is the corrected script. I noticed that you were using the old codes for both the tradeflows and the forecasts. Kindly make sure to use the updated format: thul-xxxx-xxxx-xxxx-xxxx.</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\"><i>Quote</i></span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\"><i>&nbsp;</i></span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">import requests</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">import json</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">import base64</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">import pandas as pd</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">######## get the login token ###############</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">user=&quot;user”</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">password=”password”</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">org=&quot;thul&quot;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">url = f'https://api.dnext.io/dev/auth/custom-login?org='+org</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">payload = json.dumps({</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &quot;email&quot;: user,</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &quot;password&quot;: password,</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &quot;organization&quot;: org</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">})</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">headers = {</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; 'Content-Type': 'application/json'</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">}</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">response = requests.request(&quot;POST&quot;, url, headers=headers, data=payload).json()</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">token = 'Bearer ' + response['token']</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">headers = {</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; 'Content-Type': 'application/json',</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; 'Authorization': token</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">}</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">print(&quot;token&quot;,token)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">############################################</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">##### INPUT : TRADEFLOW CODE #########</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">tradeflow_ = 'thul-6739954d-a4f8-4436-a7bc-f57bf3b79f20'</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">forecast_ = 'thul-01142ad-6fbb-83f-8ec4-63ebfaf0e42'</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">######################################</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">########## list all tradeflows to find tradeflow_id #################</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">url = 'https://api.dnext.io/v1.0/fundamentals/tradeflows?old_sharing=true'</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">tf_list = requests.get(url, headers=headers).json()</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">print (&quot;tf list&quot;,tf_list)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\"># tf_list=pd.DataFrame(tf_list)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\"># print (&quot;tf list&quot;,tf_list)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\"># tf_list = pd.DataFrame(tf_list)[['trade_flow']]</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">tf_list = pd.json_normalize(tf_list['result'])</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">tradeflow_id = tf_list[tf_list.code == tradeflow_].id.iloc[0].strip()</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">print(f&quot;Tradeflow ID: &gt;&gt;{tradeflow_id}&lt;&lt;&quot;)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">###################################</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">########### make the list of snapshot #########</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">params = {'deep': 'true'}</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">data = {&quot;where&quot;:&quot;trade_flow_id eq &quot; + tradeflow_id,&quot;hastobe&quot;:False}</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">urlsnaps=url = f'https://api.dnext.io/v1.0/fundamentals/tradeflows/{tradeflow_id}/snapshots'</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">response = requests.get(urlsnaps,params=params, headers=headers)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">print(&quot;response&quot;,response.text)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">snapshot_list = pd.DataFrame(response.json()[&quot;result&quot;])</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">snapshot_list = snapshot_list[['table_name', 'created_at']].copy()</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">##############################</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">####### INPUT : CHOOSE THE SNAPSHOT FROM ABOVE LIST ########</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">snapshot_ = 'dnexr-crn-20231011120944'</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">###############################</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">################# download the data</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">url = 'https://api.dnext.io/fundamentals/tradeflow/compare'</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">payload = json.dumps({</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &quot;code&quot;: tradeflow_,</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &quot;from&quot;: snapshot_,</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &quot;to&quot;: None,</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &quot;forecastsFrom&quot;: [</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &nbsp; forecast_</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; ],</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &quot;forecastsTo&quot;: [</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &nbsp; forecast_</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; ],</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp; &quot;startMonth&quot;: 9</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">})</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">url = requests.request(&quot;POST&quot;, url, headers=headers, data=payload).json()['url']</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">df = pd.read_json(url, lines=True)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">df = df[['Date', 'Product', 'Origin', 'Destination', 'QuantityOld']].copy()</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">df.dropna(subset=['QuantityOld'], inplace=True)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">#print(df)</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\"><i>Unquote</i></span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\"><i>&nbsp;</i></span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">Please let me know how this works on your end. I'm happy to assist further if needed.</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">Looking forward to your feedback.</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">Best regards,</span></p>\r\n<table class=\"MsoNormalTable\" cellspacing=\"0\" cellpadding=\"0\" style=\"background-color: white; border-collapse: collapse; border-spacing: 0px; box-sizing: border-box;\">\r\n<tbody>\r\n<tr>\r\n<td class=\"MsoNormalTable\" style=\"border-width: 2.25pt medium medium; border-style: solid none none; border-color: rgb(74, 68, 42) currentcolor currentcolor; padding: 0.75pt 5.4pt; vertical-align: top; width: 144.9pt; height: 31pt;\">\r\n<p class=\"MsoNormal\" style=\"line-height: 12.6pt; margin: 6pt 0in 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 10pt; color: rgb(31, 73, 125);\"><b>Saber Khalfallah</b></span></p>\r\n<p class=\"MsoNormal\" style=\"line-height: 12.6pt; margin: 0in 0in 6pt; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 9pt; color: rgb(31, 73, 125);\">Customer Support</span></p>\r\n</td>\r\n<td class=\"MsoNormalTable\" style=\"border-width: 2.25pt medium medium; border-style: solid none none; border-color: rgb(74, 68, 42) currentcolor currentcolor; padding: 0.75pt 5.4pt; vertical-align: top; width: 333.9pt; height: 31pt;\">\r\n<p class=\"MsoNormal\" style=\"text-align: right; line-height: 12.6pt; margin: 6pt 0in 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 9pt; color: rgb(31, 73, 125);\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size: 9pt; color: blue;\"><u><a href=\"mailto:saber.khalfallah@dnext.io\" style=\"color: blue; margin-top: 0px; margin-bottom: 0px;\">saber.khalfallah@dnext.io</a></u></span></p>\r\n</td>\r\n</tr>\r\n<tr>\r\n<td class=\"MsoNormalTable\" style=\"padding: 0.75pt 5.4pt; vertical-align: top; width: 144.9pt; height: 64.5pt;\">\r\n<p class=\"MsoNormal\" style=\"line-height: 12.6pt; margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"color: rgb(36, 36, 36);\"><img src=\"cid:image001.png@01DBE205.AA9D7000\" id=\"x_x_Image_x0020_1\" width=\"72\" height=\"79\" style=\"width: 0.7583in; height: 0.8333in; margin-top: 0px; margin-bottom: 0px;\"></span></p>\r\n</td>\r\n<td class=\"MsoNormalTable\" style=\"padding: 0.75pt 5.4pt; vertical-align: bottom; width: 333.9pt; height: 64.5pt;\">\r\n<p class=\"MsoNormal\" style=\"text-align: center; line-height: 12.6pt; margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"text-align: center; line-height: 12.6pt; margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"text-align: right; line-height: 12.6pt; margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 9pt; color: rgb(31, 73, 125);\"><b>DNEXT INTELLIGENCE SA </b>\r\n| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span></p>\r\n<p class=\"MsoNormal\" style=\"text-align: right; line-height: 12.6pt; margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 9pt; color: blue;\"><u><a href=\"mailto:info@dnext.io\" style=\"color: blue; margin-top: 0px; margin-bottom: 0px;\">info@dnext.io</a></u></span><span style=\"font-size: 9pt; color: rgb(36, 36, 36);\">&nbsp;</span><span style=\"font-size: 9pt; color: rgb(31, 73, 125);\">|\r\n</span><span style=\"font-size: 9pt; color: blue;\"><u><a href=\"http://www.dnext.io/\" target=\"_blank\" style=\"color: blue; margin-top: 0px; margin-bottom: 0px;\">www.dnext.io</a></u></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">&nbsp;</span></p>\r\n<div style=\"padding: 0in 0in 0in 4pt; border-width: medium medium medium 1.5pt; border-style: none none none solid; border-color: currentcolor currentcolor currentcolor blue;\">\r\n<div style=\"padding: 3pt 0in 0in; border-width: 1pt medium medium; border-style: solid none none; border-color: rgb(225, 225, 225) currentcolor currentcolor;\">\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-family: Calibri, sans-serif;\"><b>From:</b>&nbsp;Ruiz, Roberto &lt;Roberto.Ruiz@mlp.com&gt;<br>\r\n<b>Sent:</b>&nbsp;Friday, June 20, 2025 16:47<br>\r\n<b>To:</b>&nbsp;Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;<br>\r\n<b>Subject:</b>&nbsp;Trade flows version</span></p>\r\n</div>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nHello Saber,</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nHope that you’re doing well.</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nI want to compare the current corn trade flows vs a previous version. Some months ago Bastien gave me the code below that used to work for retrieving previous versions of the trade flows. Something has changed though, as this script doesn’t run as before.</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nCould you pls let me know which code I can use to query an old version of trade flows?</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nMany thanks</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nimport requests</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nimport json</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nimport base64</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nimport pandas as pd</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n######## get the login token ###############</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nuser=<span style=\"color: rgb(70, 120, 134);\"><u><a href=\"mailto:roberto.ruiz@mlp.com\" style=\"color: rgb(70, 120, 134); margin-top: 0px; margin-bottom: 0px;\">xxxxx</a></u></span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\npassword=xxx</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\norg=&quot;thul&quot;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nurl = f'https://api.dnext.io/dev/auth/custom-login?org='+org</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\npayload = json.dumps({</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; &quot;email&quot;: user,</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; &quot;password&quot;: password,</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; &quot;organization&quot;: org</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n})</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nheaders = {</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; 'Content-Type': 'application/json'</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n}</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nresponse = requests.request(&quot;POST&quot;, url, headers=headers, data=payload).json()</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ntoken = 'Bearer ' + response['token']</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nheaders = {</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; 'Content-Type': 'application/json',</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; 'Authorization': token</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n}</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n############################################</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n##### INPUT : TRADEFLOW CODE #########</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ntradeflow_ = 'dnexr-crn'</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nforecast_ = 'dnexr-crn'</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n######################################</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n########## list all tradeflows to find tradeflow_id #################</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nurl = 'https://api.dnext.io/dnext/data_sharing/?relation=[trade_flow]'</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ntf_list = requests.get(url, headers=headers).json()</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ntf_list = pd.DataFrame(tf_list)[['trade_flow']]</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ntf_list = pd.json_normalize(tf_list['trade_flow'])</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ntradeflow_id = tf_list[tf_list.code == tradeflow_].id.iloc[0]</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nprint(tradeflow_id)</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n###################################</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n########### make the list of snapshot #########</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nparams = {'deep': 'true'}</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ndata = {&quot;where&quot;:&quot;trade_flow_id eq &quot; + tradeflow_id,&quot;hastobe&quot;:False}</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nresponse = requests.post('https://api.dnext.io/search/trade_flow_snapshot', params=params, headers=headers, json=data)</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nsnapshot_list = pd.DataFrame(response.json())</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nsnapshot_list = snapshot_list[['table_name', 'createdAt']].copy()</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n##############################</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n####### INPUT : CHOOSE THE SNAPSHOT FROM ABOVE LIST ########</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nsnapshot_ = 'dnexr-crn-20231011120944'</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n###############################</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n################# download the data</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nurl = 'https://api.dnext.io/fundamentals/tradeflow/compare'</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\npayload = json.dumps({</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; &quot;code&quot;: tradeflow_,</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; &quot;from&quot;: snapshot_,</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; &quot;to&quot;: None,</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; &quot;forecastsFrom&quot;: [</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;&nbsp;&nbsp; forecast_</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; ],</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; &quot;forecastsTo&quot;: [</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp;&nbsp;&nbsp; forecast_</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; ],</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n&nbsp; &quot;startMonth&quot;: 9</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n})</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\nurl = requests.request(&quot;POST&quot;, url, headers=headers, data=payload).json()['url']</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ndf = pd.read_json(url, lines=True)</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ndf = df[['Date', 'Product', 'Origin', 'Destination', 'QuantityOld']].copy()</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\ndf.dropna(subset=['QuantityOld'], inplace=True)</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n#print(df)</p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">##########################################################<br>\r\n&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">The information contained in this communication is confidential and intended only for the person(s) or entity(ies) to which it is addressed. If you are not a named addressee, please notify the sender immediately, delete this email\r\n from your system and do not disclose the email or any part of it to any person. Any views or opinions expressed in this email are those of the author and do not necessarily represent the views of MCP (Switzerland) GmbH or any of its affiliates. Therefore,\r\n this communication is not intended as an offer or solicitation for the purchase or sale of any financial instrument or as an official confirmation of any transaction.&nbsp;</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">Electronic communications can be insecure and can contain errors, they can be intercepted, corrupted, lost, destroyed, incomplete or may contain viruses. Neither MCP (Switzerland) GmbH, its affiliates nor the sender can accept\r\n any liability for any kind of damages as the result of viruses or transmission errors or delays. Outgoing and incoming electronic communications of MCP (Switzerland) GmbH and its affiliates, including telephone communications, may be electronically archived\r\n and subject to review and/or disclosure to someone other than the recipient.</span></p>\r\n<p class=\"MsoNormal\" style=\"margin: 0in; font-family: Aptos, sans-serif; font-size: 11pt;\">\r\n<span style=\"font-size: 12pt;\">MCP (Switzerland) GmbH is a Swiss manager of collective assets authorized and regulated by the Swiss Financial Market Supervisory Authority (FINMA). MCP (Switzerland) GmbH is a limited liability company registered in Switzerland\r\n under company number CHE-216.367.660 and with its registered office at rue du Rhône 42, 1204 Geneva, Switzerland.<br>\r\n&nbsp;<br>\r\n##########################################################&nbsp;</span></p>\r\n</div>\r\n</div>\r\n</div>\r\n##########################################################<br><span>&nbsp;</span><div>The information contained in this communication is confidential and intended only for the person(s) or entity(ies) to which it is addressed. If you are not a named addressee, please notify the sender immediately, delete this email from your system and do not disclose the email or any part of it to any person. Any views or opinions expressed in this email are those of the author and do not necessarily represent the views of MCP (Switzerland) GmbH or any of its affiliates. Therefore, this communication is not intended as an offer or solicitation for the purchase or sale of any financial instrument or as an official confirmation of any transaction.&nbsp;<br><div>Electronic communications can be insecure and can contain errors, they can be intercepted, corrupted, lost, destroyed, incomplete or may contain viruses. Neither MCP (Switzerland) GmbH, its affiliates nor the sender can accept any liability for any kind of damages as the result of viruses or transmission errors or delays. Outgoing and incoming electronic communications of MCP (Switzerland) GmbH and its affiliates, including telephone communications, may be electronically archived and subject to review and/or disclosure to someone other than the recipient.<br><div>MCP (Switzerland) GmbH is a Swiss manager of collective assets authorized and regulated by the Swiss Financial Market Supervisory Authority (FINMA). MCP (Switzerland) GmbH is a limited liability company registered in Switzerland under company number CHE-216.367.660 and with its registered office at rue du Rhône 42, 1204 Geneva, Switzerland.<br><span>&nbsp;</span><br>##########################################################<span>&nbsp;</span></body>\r\n</html>\r\n",
      "conversation_id": "F4AFD4AC9FD341A2A14A5E06C20FFA4A",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD490002C63C661D0000",
      "size": 107263,
      "has_attachments": true,
      "attachments": [],
      "message_id": "GV2P191MB2381F33A4C49E4918412BE9F8D7CA@GV2P191MB2381.EURP191.PROD.OUTLOOK.COM",
      "in_reply_to": "GV0P278MB132087D09F5AABA03F2BA694F87CA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "references": "in-reply-to:mime-version;\r\n  bh=+cvONFCQm0GfZoENxjhNnXok29gkMHHRx9/jhBvnfJ4=;\r\n  b=XvwZEOQeAoZeBm+pZ8+/RuBN3J93gFmdn7SHS9TWI9uCOTB1ZJC1F7Vz\r\n   Ed5b1LrSubKI252COhqCaOK+xXZKxxTpcCcSqdt0YYU1zHyVDcSqdKu4E\r\n   FTLyYf48km+b/gNzuobIOqiLdhTKTeDvuwSIV8elXv/47a+/vdNoRuwi2\r\n   Vne7+aI+HTt5jKujp7dEZgQuNwSK9ZE3mWJmb//4ROovffP553i2h3OFk\r\n   sQ5ZG1E0MPFX/R0B5dPWp6n5+o13JAYT16cm+T1dMAySftp92XffeAzv4\r\n   oAjp/v1PfsklXc+ppCjOEmAS0m3xLiVcWvWAGPnJ44VpvgdRvZxifde9N\r\n   w==;"
    },
    {
      "subject": "RE: Trade flows version",
      "from": "/O=EXCHANGELABS/OU=EXCHANGE ADMINISTRATIVE GROUP (FYDIBOHF23SPDLT)/CN=RECIPIENTS/CN=EC49082C17FD4A35889594A9C7ADF53D-30DE44D7-0A",
      "from_name": "Saber Khalfallah",
      "to": "Robero Ruiz",
      "cc": "Support Dnext",
      "received_time": "2025-06-20 17:49:13.951000+00:00",
      "sent_time": "2025-06-20 17:49:11+00:00",
      "body_text": "Hello Roberto,\r\n\r\n \r\n\r\nThank you for reaching out.\r\n\r\n \r\n\r\nBelow is the corrected script. I noticed that you were using the old codes for both the tradeflows and the forecasts. Kindly make sure to use the updated format: thul-xxxx-xxxx-xxxx-xxxx.\r\n\r\n \r\n\r\nQuote \r\n\r\n \r\n\r\nimport requests\r\n\r\nimport json\r\n\r\nimport base64\r\n\r\nimport pandas as pd\r\n\r\n \r\n\r\n######## get the login token ###############\r\n\r\nuser=\"user”\r\n\r\npassword=”password”\r\n\r\norg=\"thul\"\r\n\r\nurl = f'https://api.dnext.io/dev/auth/custom-login?org='+org\r\n\r\npayload = json.dumps({\r\n\r\n  \"email\": user,\r\n\r\n  \"password\": password,\r\n\r\n  \"organization\": org\r\n\r\n})\r\n\r\nheaders = {\r\n\r\n  'Content-Type': 'application/json'\r\n\r\n}\r\n\r\nresponse = requests.request(\"POST\", url, headers=headers, data=payload).json()\r\n\r\ntoken = 'Bearer ' + response['token']\r\n\r\n \r\n\r\nheaders = {\r\n\r\n  'Content-Type': 'application/json',\r\n\r\n  'Authorization': token\r\n\r\n}\r\n\r\n \r\n\r\nprint(\"token\",token)\r\n\r\n############################################\r\n\r\n##### INPUT : TRADEFLOW CODE #########\r\n\r\ntradeflow_ = 'thul-6739954d-a4f8-4436-a7bc-f57bf3b79f20'\r\n\r\nforecast_ = 'thul-01142ad-6fbb-83f-8ec4-63ebfaf0e42'\r\n\r\n######################################\r\n\r\n########## list all tradeflows to find tradeflow_id #################\r\n\r\nurl = 'https://api.dnext.io/v1.0/fundamentals/tradeflows?old_sharing=true'\r\n\r\ntf_list = requests.get(url, headers=headers).json()\r\n\r\nprint (\"tf list\",tf_list)\r\n\r\n# tf_list=pd.DataFrame(tf_list)\r\n\r\n# print (\"tf list\",tf_list)\r\n\r\n \r\n\r\n# tf_list = pd.DataFrame(tf_list)[['trade_flow']]\r\n\r\ntf_list = pd.json_normalize(tf_list['result'])\r\n\r\ntradeflow_id = tf_list[tf_list.code == tradeflow_].id.iloc[0].strip()\r\n\r\nprint(f\"Tradeflow ID: >>{tradeflow_id}<<\")\r\n\r\n \r\n\r\n###################################\r\n\r\n########### make the list of snapshot #########\r\n\r\nparams = {'deep': 'true'}\r\n\r\ndata = {\"where\":\"trade_flow_id eq \" + tradeflow_id,\"hastobe\":False}\r\n\r\nurlsnaps=url = f'https://api.dnext.io/v1.0/fundamentals/tradeflows/{tradeflow_id}/snapshots'\r\n\r\n \r\n\r\nresponse = requests.get(urlsnaps,params=params, headers=headers)\r\n\r\nprint(\"response\",response.text)\r\n\r\nsnapshot_list = pd.DataFrame(response.json()[\"result\"])\r\n\r\n \r\n\r\nsnapshot_list = snapshot_list[['table_name', 'created_at']].copy() \r\n\r\n##############################\r\n\r\n####### INPUT : CHOOSE THE SNAPSHOT FROM ABOVE LIST ########\r\n\r\nsnapshot_ = 'dnexr-crn-20231011120944'\r\n\r\n###############################\r\n\r\n################# download the data\r\n\r\nurl = 'https://api.dnext.io/fundamentals/tradeflow/compare'\r\n\r\npayload = json.dumps({\r\n\r\n  \"code\": tradeflow_,\r\n\r\n  \"from\": snapshot_,\r\n\r\n  \"to\": None,\r\n\r\n  \"forecastsFrom\": [\r\n\r\n    forecast_\r\n\r\n  ],\r\n\r\n  \"forecastsTo\": [\r\n\r\n    forecast_\r\n\r\n  ],\r\n\r\n  \"startMonth\": 9\r\n\r\n})\r\n\r\nurl = requests.request(\"POST\", url, headers=headers, data=payload).json()['url']\r\n\r\ndf = pd.read_json(url, lines=True)\r\n\r\ndf = df[['Date', 'Product', 'Origin', 'Destination', 'QuantityOld']].copy()\r\n\r\ndf.dropna(subset=['QuantityOld'], inplace=True)\r\n\r\n#print(df)\r\n\r\n \r\n\r\nUnquote\r\n\r\n \r\n\r\nPlease let me know how this works on your end. I'm happy to assist further if needed.\r\n\r\n \r\n\r\nLooking forward to your feedback.\r\n\r\n \r\n\r\nBest regards,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Ruiz, Roberto <Roberto.Ruiz@mlp.com> \r\nSent: Friday, June 20, 2025 16:47\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io>\r\nSubject: Trade flows version\r\n\r\n \r\n\r\nHello Saber,\r\n\r\n \r\n\r\nHope that you’re doing well.\r\n\r\nI want to compare the current corn trade flows vs a previous version. Some months ago Bastien gave me the code below that used to work for retrieving previous versions of the trade flows. Something has changed though, as this script doesn’t run as before.\r\n\r\nCould you pls let me know which code I can use to query an old version of trade flows?\r\n\r\n \r\n\r\n \r\n\r\nMany thanks\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nimport requests\r\n\r\nimport json\r\n\r\nimport base64\r\n\r\nimport pandas as pd\r\n\r\n \r\n\r\n######## get the login token ###############\r\n\r\nuser=xxxxx <mailto:roberto.ruiz@mlp.com> \r\n\r\npassword=xxx\r\n\r\norg=\"thul\"\r\n\r\nurl = f'https://api.dnext.io/dev/auth/custom-login?org='+org\r\n\r\npayload = json.dumps({\r\n\r\n  \"email\": user,\r\n\r\n  \"password\": password,\r\n\r\n  \"organization\": org\r\n\r\n})\r\n\r\nheaders = {\r\n\r\n  'Content-Type': 'application/json'\r\n\r\n}\r\n\r\nresponse = requests.request(\"POST\", url, headers=headers, data=payload).json()\r\n\r\ntoken = 'Bearer ' + response['token']\r\n\r\n \r\n\r\nheaders = {\r\n\r\n  'Content-Type': 'application/json',\r\n\r\n  'Authorization': token\r\n\r\n}\r\n\r\n \r\n\r\n \r\n\r\n############################################\r\n\r\n##### INPUT : TRADEFLOW CODE #########\r\n\r\ntradeflow_ = 'dnexr-crn'\r\n\r\nforecast_ = 'dnexr-crn'\r\n\r\n######################################\r\n\r\n########## list all tradeflows to find tradeflow_id #################\r\n\r\nurl = 'https://api.dnext.io/dnext/data_sharing/?relation=[trade_flow]'\r\n\r\ntf_list = requests.get(url, headers=headers).json()\r\n\r\n \r\n\r\ntf_list = pd.DataFrame(tf_list)[['trade_flow']]\r\n\r\ntf_list = pd.json_normalize(tf_list['trade_flow'])\r\n\r\ntradeflow_id = tf_list[tf_list.code == tradeflow_].id.iloc[0]\r\n\r\n \r\n\r\nprint(tradeflow_id)\r\n\r\n \r\n\r\n###################################\r\n\r\n########### make the list of snapshot #########\r\n\r\nparams = {'deep': 'true'}\r\n\r\ndata = {\"where\":\"trade_flow_id eq \" + tradeflow_id,\"hastobe\":False}\r\n\r\nresponse = requests.post('https://api.dnext.io/search/trade_flow_snapshot', params=params, headers=headers, json=data)\r\n\r\nsnapshot_list = pd.DataFrame(response.json())\r\n\r\nsnapshot_list = snapshot_list[['table_name', 'createdAt']].copy() \r\n\r\n##############################\r\n\r\n####### INPUT : CHOOSE THE SNAPSHOT FROM ABOVE LIST ########\r\n\r\nsnapshot_ = 'dnexr-crn-20231011120944'\r\n\r\n###############################\r\n\r\n################# download the data\r\n\r\nurl = 'https://api.dnext.io/fundamentals/tradeflow/compare'\r\n\r\npayload = json.dumps({\r\n\r\n  \"code\": tradeflow_,\r\n\r\n  \"from\": snapshot_,\r\n\r\n  \"to\": None,\r\n\r\n  \"forecastsFrom\": [\r\n\r\n    forecast_\r\n\r\n  ],\r\n\r\n  \"forecastsTo\": [\r\n\r\n    forecast_\r\n\r\n  ],\r\n\r\n  \"startMonth\": 9\r\n\r\n})\r\n\r\nurl = requests.request(\"POST\", url, headers=headers, data=payload).json()['url']\r\n\r\ndf = pd.read_json(url, lines=True)\r\n\r\ndf = df[['Date', 'Product', 'Origin', 'Destination', 'QuantityOld']].copy()\r\n\r\ndf.dropna(subset=['QuantityOld'], inplace=True)\r\n\r\n#print(df)\r\n\r\n##########################################################\r\n \r\n\r\nThe information contained in this communication is confidential and intended only for the person(s) or entity(ies) to which it is addressed. If you are not a named addressee, please notify the sender immediately, delete this email from your system and do not disclose the email or any part of it to any person. Any views or opinions expressed in this email are those of the author and do not necessarily represent the views of MCP (Switzerland) GmbH or any of its affiliates. Therefore, this communication is not intended as an offer or solicitation for the purchase or sale of any financial instrument or as an official confirmation of any transaction. \r\n\r\nElectronic communications can be insecure and can contain errors, they can be intercepted, corrupted, lost, destroyed, incomplete or may contain viruses. Neither MCP (Switzerland) GmbH, its affiliates nor the sender can accept any liability for any kind of damages as the result of viruses or transmission errors or delays. Outgoing and incoming electronic communications of MCP (Switzerland) GmbH and its affiliates, including telephone communications, may be electronically archived and subject to review and/or disclosure to someone other than the recipient.\r\n\r\nMCP (Switzerland) GmbH is a Swiss manager of collective assets authorized and regulated by the Swiss Financial Market Supervisory Authority (FINMA). MCP (Switzerland) GmbH is a limited liability company registered in Switzerland under company number CHE-216.367.660 and with its registered office at rue du Rhône 42, 1204 Geneva, Switzerland.\r\n \r\n########################################################## \r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><meta name=Generator content=\"Microsoft Word 15 (filtered medium)\"><!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:11.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tmso-ligatures:standardcontextual;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle19\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style><!--[if gte mso 9]><xml>\r\n<o:shapedefaults v:ext=\"edit\" spidmax=\"1026\" />\r\n</xml><![endif]--><!--[if gte mso 9]><xml>\r\n<o:shapelayout v:ext=\"edit\">\r\n<o:idmap v:ext=\"edit\" data=\"1\" />\r\n</o:shapelayout></xml><![endif]--></head><body lang=EN-US link=\"#467886\" vlink=\"#96607D\" style='word-wrap:break-word'><div class=WordSection1><div><p class=MsoNormal><span style='font-size:12.0pt'>Hello Roberto,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>Thank you for reaching out.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>Below is the corrected script. I noticed that you were using the old codes for both the tradeflows and the forecasts. Kindly make sure to use the updated format: thul-xxxx-xxxx-xxxx-xxxx.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><i><span style='font-size:12.0pt'>Quote <o:p></o:p></span></i></p><p class=MsoNormal><i><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></i></p><p class=MsoNormal><span style='font-size:12.0pt'>import requests<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>import json<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>import base64<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>import pandas as pd<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>######## get the login token ###############<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>user=&quot;user”<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>password=”password”<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>org=&quot;thul&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>url = f'https://api.dnext.io/dev/auth/custom-login?org='+org<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>payload = json.dumps({<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &quot;email&quot;: user,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &quot;password&quot;: password,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &quot;organization&quot;: org<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>})<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>headers = {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; 'Content-Type': 'application/json'<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>response = requests.request(&quot;POST&quot;, url, headers=headers, data=payload).json()<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>token = 'Bearer ' + response['token']<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>headers = {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; 'Content-Type': 'application/json',<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; 'Authorization': token<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>print(&quot;token&quot;,token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>############################################<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>##### INPUT : TRADEFLOW CODE #########<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>tradeflow_ = 'thul-6739954d-a4f8-4436-a7bc-f57bf3b79f20'<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>forecast_ = 'thul-01142ad-6fbb-83f-8ec4-63ebfaf0e42'<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>######################################<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>########## list all tradeflows to find tradeflow_id #################<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>url = 'https://api.dnext.io/v1.0/fundamentals/tradeflows?old_sharing=true'<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>tf_list = requests.get(url, headers=headers).json()<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>print (&quot;tf list&quot;,tf_list)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'># tf_list=pd.DataFrame(tf_list)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'># print (&quot;tf list&quot;,tf_list)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'># tf_list = pd.DataFrame(tf_list)[['trade_flow']]<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>tf_list = pd.json_normalize(tf_list['result'])<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>tradeflow_id = tf_list[tf_list.code == tradeflow_].id.iloc[0].strip()<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>print(f&quot;Tradeflow ID: &gt;&gt;{tradeflow_id}&lt;&lt;&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>###################################<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>########### make the list of snapshot #########<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>params = {'deep': 'true'}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>data = {&quot;where&quot;:&quot;trade_flow_id eq &quot; + tradeflow_id,&quot;hastobe&quot;:False}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>urlsnaps=url = f'https://api.dnext.io/v1.0/fundamentals/tradeflows/{tradeflow_id}/snapshots'<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>response = requests.get(urlsnaps,params=params, headers=headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>print(&quot;response&quot;,response.text)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>snapshot_list = pd.DataFrame(response.json()[&quot;result&quot;])<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>snapshot_list = snapshot_list[['table_name', 'created_at']].copy() <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>##############################<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>####### INPUT : CHOOSE THE SNAPSHOT FROM ABOVE LIST ########<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>snapshot_ = 'dnexr-crn-20231011120944'<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>###############################<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>################# download the data<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>url = 'https://api.dnext.io/fundamentals/tradeflow/compare'<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>payload = json.dumps({<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &quot;code&quot;: tradeflow_,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &quot;from&quot;: snapshot_,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &quot;to&quot;: None,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &quot;forecastsFrom&quot;: [<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &nbsp; forecast_<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; ],<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &quot;forecastsTo&quot;: [<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &nbsp; forecast_<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; ],<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>&nbsp; &quot;startMonth&quot;: 9<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>})<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>url = requests.request(&quot;POST&quot;, url, headers=headers, data=payload).json()['url']<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>df = pd.read_json(url, lines=True)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>df = df[['Date', 'Product', 'Origin', 'Destination', 'QuantityOld']].copy()<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>df.dropna(subset=['QuantityOld'], inplace=True)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>#print(df)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><i><span style='font-size:12.0pt'>Unquote<o:p></o:p></span></i></p><p class=MsoNormal><i><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></i></p><p class=MsoNormal><span style='font-size:12.0pt'>Please let me know how this works on your end. I'm happy to assist further if needed.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>Looking forward to your feedback.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>Best regards,</span><span style='font-size:12.0pt'><o:p></o:p></span></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='font-size:10.0pt;color:#1F497D'>Saber Khalfallah</span></b><span style='font-size:12.0pt'><o:p></o:p></span></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>Customer Support</span><span style='font-size:12.0pt'><o:p></o:p></span></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='color:black'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='font-size:9.0pt;color:blue'>saber.khalfallah@dnext.io</span></a></span><span style='font-size:12.0pt'><o:p></o:p></span></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='color:#242424;mso-ligatures:none'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"x_x_Image_x0020_1\" src=\"cid:image001.png@01DBE205.AA9D7000\"></span><span style='font-size:12.0pt'><o:p></o:p></span></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style='font-size:12.0pt'><o:p></o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='color:black'><a href=\"mailto:info@dnext.io\"><span style='font-size:9.0pt;color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D'>| </span><span style='color:black'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='font-size:9.0pt;color:blue'>www.dnext.io</span></a></span><span style='font-size:12.0pt'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p></div><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><div style='border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt'><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-family:\"Calibri\",sans-serif;mso-ligatures:none'>From:</span></b><span style='font-family:\"Calibri\",sans-serif;mso-ligatures:none'> Ruiz, Roberto &lt;Roberto.Ruiz@mlp.com&gt; <br><b>Sent:</b> Friday, June 20, 2025 16:47<br><b>To:</b> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;<br><b>Subject:</b> Trade flows version<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Hello Saber,<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Hope that you’re doing well.<o:p></o:p></p><p class=MsoNormal>I want to compare the current corn trade flows vs a previous version. Some months ago Bastien gave me the code below that used to work for retrieving previous versions of the trade flows. Something has changed though, as this script doesn’t run as before.<o:p></o:p></p><p class=MsoNormal>Could you pls let me know which code I can use to query an old version of trade flows?<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Many thanks<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>import requests<o:p></o:p></p><p class=MsoNormal>import json<o:p></o:p></p><p class=MsoNormal>import base64<o:p></o:p></p><p class=MsoNormal>import pandas as pd<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>######## get the login token ###############<o:p></o:p></p><p class=MsoNormal>user=<a href=\"mailto:roberto.ruiz@mlp.com\">xxxxx</a><o:p></o:p></p><p class=MsoNormal>password=xxx<o:p></o:p></p><p class=MsoNormal>org=&quot;thul&quot;<o:p></o:p></p><p class=MsoNormal>url = f'https://api.dnext.io/dev/auth/custom-login?org='+org<o:p></o:p></p><p class=MsoNormal>payload = json.dumps({<o:p></o:p></p><p class=MsoNormal>&nbsp; &quot;email&quot;: user,<o:p></o:p></p><p class=MsoNormal>&nbsp; &quot;password&quot;: password,<o:p></o:p></p><p class=MsoNormal>&nbsp; &quot;organization&quot;: org<o:p></o:p></p><p class=MsoNormal>})<o:p></o:p></p><p class=MsoNormal>headers = {<o:p></o:p></p><p class=MsoNormal>&nbsp; 'Content-Type': 'application/json'<o:p></o:p></p><p class=MsoNormal>}<o:p></o:p></p><p class=MsoNormal>response = requests.request(&quot;POST&quot;, url, headers=headers, data=payload).json()<o:p></o:p></p><p class=MsoNormal>token = 'Bearer ' + response['token']<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>headers = {<o:p></o:p></p><p class=MsoNormal>&nbsp; 'Content-Type': 'application/json',<o:p></o:p></p><p class=MsoNormal>&nbsp; 'Authorization': token<o:p></o:p></p><p class=MsoNormal>}<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>############################################<o:p></o:p></p><p class=MsoNormal>##### INPUT : TRADEFLOW CODE #########<o:p></o:p></p><p class=MsoNormal>tradeflow_ = 'dnexr-crn'<o:p></o:p></p><p class=MsoNormal>forecast_ = 'dnexr-crn'<o:p></o:p></p><p class=MsoNormal>######################################<o:p></o:p></p><p class=MsoNormal>########## list all tradeflows to find tradeflow_id #################<o:p></o:p></p><p class=MsoNormal>url = 'https://api.dnext.io/dnext/data_sharing/?relation=[trade_flow]'<o:p></o:p></p><p class=MsoNormal>tf_list = requests.get(url, headers=headers).json()<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>tf_list = pd.DataFrame(tf_list)[['trade_flow']]<o:p></o:p></p><p class=MsoNormal>tf_list = pd.json_normalize(tf_list['trade_flow'])<o:p></o:p></p><p class=MsoNormal>tradeflow_id = tf_list[tf_list.code == tradeflow_].id.iloc[0]<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>print(tradeflow_id)<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>###################################<o:p></o:p></p><p class=MsoNormal>########### make the list of snapshot #########<o:p></o:p></p><p class=MsoNormal>params = {'deep': 'true'}<o:p></o:p></p><p class=MsoNormal>data = {&quot;where&quot;:&quot;trade_flow_id eq &quot; + tradeflow_id,&quot;hastobe&quot;:False}<o:p></o:p></p><p class=MsoNormal>response = requests.post('https://api.dnext.io/search/trade_flow_snapshot', params=params, headers=headers, json=data)<o:p></o:p></p><p class=MsoNormal>snapshot_list = pd.DataFrame(response.json())<o:p></o:p></p><p class=MsoNormal>snapshot_list = snapshot_list[['table_name', 'createdAt']].copy() <o:p></o:p></p><p class=MsoNormal>##############################<o:p></o:p></p><p class=MsoNormal>####### INPUT : CHOOSE THE SNAPSHOT FROM ABOVE LIST ########<o:p></o:p></p><p class=MsoNormal>snapshot_ = 'dnexr-crn-20231011120944'<o:p></o:p></p><p class=MsoNormal>###############################<o:p></o:p></p><p class=MsoNormal>################# download the data<o:p></o:p></p><p class=MsoNormal>url = 'https://api.dnext.io/fundamentals/tradeflow/compare'<o:p></o:p></p><p class=MsoNormal>payload = json.dumps({<o:p></o:p></p><p class=MsoNormal>&nbsp; &quot;code&quot;: tradeflow_,<o:p></o:p></p><p class=MsoNormal>&nbsp; &quot;from&quot;: snapshot_,<o:p></o:p></p><p class=MsoNormal>&nbsp; &quot;to&quot;: None,<o:p></o:p></p><p class=MsoNormal>&nbsp; &quot;forecastsFrom&quot;: [<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; forecast_<o:p></o:p></p><p class=MsoNormal>&nbsp; ],<o:p></o:p></p><p class=MsoNormal>&nbsp; &quot;forecastsTo&quot;: [<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; forecast_<o:p></o:p></p><p class=MsoNormal>&nbsp; ],<o:p></o:p></p><p class=MsoNormal>&nbsp; &quot;startMonth&quot;: 9<o:p></o:p></p><p class=MsoNormal>})<o:p></o:p></p><p class=MsoNormal>url = requests.request(&quot;POST&quot;, url, headers=headers, data=payload).json()['url']<o:p></o:p></p><p class=MsoNormal>df = pd.read_json(url, lines=True)<o:p></o:p></p><p class=MsoNormal>df = df[['Date', 'Product', 'Origin', 'Destination', 'QuantityOld']].copy()<o:p></o:p></p><p class=MsoNormal>df.dropna(subset=['QuantityOld'], inplace=True)<o:p></o:p></p><p class=MsoNormal>#print(df)<o:p></o:p></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:none'>##########################################################<br>&nbsp;<o:p></o:p></span></p><div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:none'>The information contained in this communication is confidential and intended only for the person(s) or entity(ies) to which it is addressed. If you are not a named addressee, please notify the sender immediately, delete this email from your system and do not disclose the email or any part of it to any person. Any views or opinions expressed in this email are those of the author and do not necessarily represent the views of MCP (Switzerland) GmbH or any of its affiliates. Therefore, this communication is not intended as an offer or solicitation for the purchase or sale of any financial instrument or as an official confirmation of any transaction.&nbsp;<o:p></o:p></span></p><div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:none'>Electronic communications can be insecure and can contain errors, they can be intercepted, corrupted, lost, destroyed, incomplete or may contain viruses. Neither MCP (Switzerland) GmbH, its affiliates nor the sender can accept any liability for any kind of damages as the result of viruses or transmission errors or delays. Outgoing and incoming electronic communications of MCP (Switzerland) GmbH and its affiliates, including telephone communications, may be electronically archived and subject to review and/or disclosure to someone other than the recipient.<o:p></o:p></span></p><div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:none'>MCP (Switzerland) GmbH is a Swiss manager of collective assets authorized and regulated by the Swiss Financial Market Supervisory Authority (FINMA). MCP (Switzerland) GmbH is a limited liability company registered in Switzerland under company number CHE-216.367.660 and with its registered office at rue du Rhône 42, 1204 Geneva, Switzerland.<br>&nbsp;<br>##########################################################&nbsp;<o:p></o:p></span></p></div></div></div></div></div></body></html>",
      "conversation_id": "F4AFD4AC9FD341A2A14A5E06C20FFA4A",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD490002C63C661C0000",
      "size": 87055,
      "has_attachments": true,
      "attachments": [],
      "message_id": "GV0P278MB132087D09F5AABA03F2BA694F87CA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "in_reply_to": "GV2P191MB2381D25B56C6D68F10CCD6868D7CA@GV2P191MB2381.EURP191.PROD.OUTLOOK.COM",
      "references": "<GV2P191MB2381D25B56C6D68F10CCD6868D7CA@GV2P191MB2381.EURP191.PROD.OUTLOOK.COM>"
    }
  ],
  "subject": "Re: [EXTERNAL] RE: Trade flows version"
}