{
  "emails": [
    {
      "subject": "RE: Issue Dnext API ",
      "from": "e.cornette@saftco.ch",
      "from_name": "Cornette Etienne",
      "to": "Saber Khalfallah",
      "cc": "Support Dnext",
      "received_time": "2025-03-25 12:16:27.583000+00:00",
      "sent_time": "2025-03-25 12:16:04+00:00",
      "body_text": "Anytime from now\r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io> \r\nSent: Tuesday, March 25, 2025 12:15 PM\r\nTo: Cornette Etienne <e.cornette@saftco.ch>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: RE: Issue Dnext API \r\n\r\n \r\n\r\n*************************************Mail_Externe*********************************\r\n\r\n* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles. Signalez tout e-mail suspect à l'équipe service desk ou transmettez-le à l’adresse : itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information. Report any suspicious emails to the service desk team or forward them to: itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n******************************************************************************************\r\n\r\nHello Etienne ,\r\n\r\nwhen would you be available for a quick teams call so we can see this together ?\r\n\r\n \r\n\r\nBest regards \r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> > \r\nSent: Tuesday, March 25, 2025 12:09\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Issue Dnext API \r\n\r\n \r\n\r\nHello Saber,\r\n\r\n \r\n\r\nThanks much. \r\n\r\nUnfortunately, I still encounter the same error. \r\n\r\n \r\n\r\nEtienne \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Tuesday, March 25, 2025 9:46 AM\r\nTo: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Issue Dnext API \r\n\r\n \r\n\r\n*************************************Mail_Externe*********************************\r\n\r\n* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles. Signalez tout e-mail suspect à l'équipe service desk ou transmettez-le à l’adresse : itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information. Report any suspicious emails to the service desk team or forward them to: itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n******************************************************************************************\r\n\r\nHello Etienne,\r\n\r\n \r\n\r\nI hope you're doing well.\r\n\r\n \r\n\r\nIt appears that the password you entered in the script is incorrect. Below is the correct password:\r\n\r\n \r\n\r\nAPI Authentication Password: jgyH6564jijliuhçà_mkkjh\r\n\r\n \r\n\r\nPlease replace the current password in the script with this one, and everything should work as expected.\r\n\r\n \r\n\r\nLet me know how it goes.\r\n\r\n \r\n\r\nBest regards,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> > \r\nSent: Monday, March 24, 2025 19:18\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: Issue Dnext API \r\n\r\n \r\n\r\nHello Saber,\r\n\r\n \r\n\r\nHope all good. For some reason, I continue to struggle to connect to API  : \r\n\r\n \r\n\r\nCode below: \r\n\r\n \r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(\"https://api.dnext.io/v1.0/auth/custom-login?org= <https://api.dnext.io/v1.0/auth/custom-login?org=> \", env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(\"e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> \", \"jgyH6564jijliuhC'C _mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nResults : \r\n\r\n \r\n\r\n  \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head>\r\n\r\n<meta name=\"Generator\" content=\"Microsoft Word 15 (filtered medium)\">\r\n<!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n@font-face\r\n\t{font-family:Consolas;\r\n\tpanose-1:2 11 6 9 2 2 4 3 2 4;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:10.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle23\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style><!--[if gte mso 9]><xml>\r\n<o:shapedefaults v:ext=\"edit\" spidmax=\"1026\" />\r\n</xml><![endif]--><!--[if gte mso 9]><xml>\r\n<o:shapelayout v:ext=\"edit\">\r\n<o:idmap v:ext=\"edit\" data=\"1\" />\r\n</o:shapelayout></xml><![endif]-->\r\n</head>\r\n<body lang=\"EN-US\" link=\"#467886\" vlink=\"#96607D\" style=\"word-wrap:break-word\">\r\n<div class=\"WordSection1\">\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Anytime from now<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;\r\n<br>\r\n<b>Sent:</b> Tuesday, March 25, 2025 12:15 PM<br>\r\n<b>To:</b> Cornette Etienne &lt;e.cornette@saftco.ch&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;support@dnext.io&gt;<br>\r\n<b>Subject:</b> RE: Issue Dnext API <o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><o:p>&nbsp;</o:p></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">*************************************Mail_Externe*********************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles.&nbsp;Signalez tout e-mail suspect\r\n à l'équipe service desk ou transmettez-le à l’adresse : <a href=\"mailto:itsecurity@ocpgroup.ma\">\r\nitsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information.&nbsp;Report any suspicious emails to the service desk team or forward them to:\r\n<a href=\"mailto:itsecurity@ocpgroup.ma\">itsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">******************************************************************************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\">Hello Etienne ,<br>\r\n<br>\r\nwhen would you be available for a quick teams call so we can see this together ?<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Best regards\r\n<o:p></o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background:white;border-collapse:collapse\">\r\n<tbody>\r\n<tr style=\"height:31.0pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<b><span style=\"color:#1F497D;mso-ligatures:standardcontextual\">Saber Khalfallah</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">Customer Support</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"top\" style=\"width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" align=\"right\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual\"><a href=\"mailto:saber.khalfallah@dnext.io\"><span style=\"color:blue\">saber.khalfallah@dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n<tr style=\"height:64.5pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<span style=\"font-size:11.0pt;color:#242424\"><img border=\"0\" width=\"73\" height=\"80\" style=\"width:.7583in;height:.8333in\" id=\"Picture_x0020_2\" src=\"cid:image001.png@01DB9D7F.AC42D4B0\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"bottom\" style=\"width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">DNEXT INTELLIGENCE SA\r\n</span></b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"mailto:info@dnext.io\"><span style=\"color:blue\">info@dnext.io</span></a></span><span style=\"font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual\">&nbsp;</span><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">|\r\n</span><span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style=\"color:blue\">www.dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;\r\n<br>\r\n<b>Sent:</b> Tuesday, March 25, 2025 12:09<br>\r\n<b>To:</b> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> RE: Issue Dnext API <o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><o:p>&nbsp;</o:p></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Hello Saber,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Thanks much. <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Unfortunately, I still encounter the same error.\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Etienne <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;\r\n<br>\r\n<b>Sent:</b> Tuesday, March 25, 2025 9:46 AM<br>\r\n<b>To:</b> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> RE: Issue Dnext API <o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><o:p>&nbsp;</o:p></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">*************************************Mail_Externe*********************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles.&nbsp;Signalez tout e-mail suspect\r\n à l'équipe service desk ou transmettez-le à l’adresse : <a href=\"mailto:itsecurity@ocpgroup.ma\">\r\nitsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information.&nbsp;Report any suspicious emails to the service desk team or forward them to:\r\n<a href=\"mailto:itsecurity@ocpgroup.ma\">itsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">******************************************************************************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Hello Etienne,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">I hope you're doing well.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">It appears that the password you entered in the script is incorrect. Below is the correct password:<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">API Authentication Password</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">: jgyH6564jijliuhçà_mkkjh<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Please replace the current password in the script with this one, and everything should work as expected.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Let me know how it goes.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Best regards,<o:p></o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background:white;border-collapse:collapse\">\r\n<tbody>\r\n<tr style=\"height:31.0pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<b><span style=\"color:#1F497D;mso-ligatures:standardcontextual\">Saber Khalfallah</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">Customer Support</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"top\" style=\"width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" align=\"right\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size:12.0pt;color:black;mso-ligatures:standardcontextual\"><a href=\"mailto:saber.khalfallah@dnext.io\"><span style=\"font-size:9.0pt;color:blue\">saber.khalfallah@dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n<tr style=\"height:64.5pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<span style=\"font-size:11.0pt;color:#242424\"><img border=\"0\" width=\"73\" height=\"80\" style=\"width:.7583in;height:.8333in\" id=\"x_x_Image_x0020_1\" src=\"cid:image001.png@01DB9D7F.AC42D4B0\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"bottom\" style=\"width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">DNEXT INTELLIGENCE SA\r\n</span></b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;color:black;mso-ligatures:standardcontextual\"><a href=\"mailto:info@dnext.io\"><span style=\"font-size:9.0pt;color:blue\">info@dnext.io</span></a></span><span style=\"font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual\">&nbsp;</span><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">|\r\n</span><span style=\"font-size:12.0pt;color:black;mso-ligatures:standardcontextual\"><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style=\"font-size:9.0pt;color:blue\">www.dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;\r\n<br>\r\n<b>Sent:</b> Monday, March 24, 2025 19:18<br>\r\n<b>To:</b> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> Issue Dnext API <o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Hello Saber,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Hope all good. For some reason, I continue to struggle to connect to API&nbsp; :\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Code below:\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Load required libraries\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(httr)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(jsonlite)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(readr)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Function to login to API and get token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">connect &lt;- function(email, pwd, env) {\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# email: email used to connect to your dnext environment\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# pwd: password\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV'\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Construct the URL\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;</span><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">url &lt;- paste0(&quot;</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\"><span lang=\"FR\" style=\"font-size:11.0pt\">https://api.dnext.io/v1.0/auth/custom-login?org=</span></a></span><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&quot;,\r\n env) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;</span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Create the payload\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;payload &lt;- toJSON(list(\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;email = email,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;password = pwd,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;organization = env\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;), auto_unbox = TRUE)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Set the headers\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json')\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Send the POST request\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Parse the response and extract the token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;token &lt;- content(response)$token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(token)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Call the connect function with your credentials\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">token &lt;- connect(&quot;</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><a href=\"mailto:e.cornette@saftco.ch\"><span style=\"font-size:11.0pt\">e.cornette@saftco.ch</span></a></span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&quot;,\r\n &quot;jgyH6564jijliuhC'C _mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">token<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<b>while</b> (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\r\n<b>else</b> <b>if</b> (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<b>break</b>&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (!success) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(success)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Function to download dataset<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">download_dataset &lt;- function(code, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<b>if</b> (is.null(res_json$task$id)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<b>if</b> (data_ready) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<b>if</b> (!is.null(res_json$result$url)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (data_resp$status_code == 200) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\r\n<b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }\r\n<b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }\r\n<b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(df)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Example usage<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Debug: Print dataset preview if successful<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">if</span></b><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"> (!is.null(df)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(head(df))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}\r\n<b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Results :\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><img border=\"0\" width=\"374\" height=\"182\" style=\"width:3.9in;height:1.9in\" id=\"_x0000_i1026\" src=\"cid:image002.png@01DB9D7F.AC42D4B0\"></span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Best regards,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Etienne Cornette<o:p></o:p></span></b></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Grains Trader<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">==============<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">SAFTCO SA\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Rue du Mont-Blanc 3,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">1201 GENEVA – CH<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><img border=\"0\" width=\"160\" height=\"121\" style=\"width:1.6666in;height:1.2583in\" id=\"Picture_x0020_1\" src=\"cid:image003.png@01DB9D7F.AC42D4B0\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">------------------------------DISCLAIMER------------------------------------</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque\r\n forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce\r\n message s'avérait modifié ou falsifié.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this\r\n message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible\r\n to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">------------------------------DISCLAIMER------------------------------------</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque\r\n forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce\r\n message s'avérait modifié ou falsifié.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this\r\n message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible\r\n to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n</body>\r\n</html>\r\n\r\n<table width=\"100%\"><tr><td bgcolor=\"#ffffff\"><font color=\"#000000\"><pre><p><span style=\"color: rgb(0, 112, 192);\">------------------------------DISCLAIMER------------------------------------</span></p><p><span style=\"color: rgb(0, 112, 192);\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span></p><p><span style=\"color: rgb(0, 112, 192);\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span></p></pre></font></td></tr></table>",
      "conversation_id": "D66AD69D9FC3402A9C4625D1A43DAA8F",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD4900028B5F2A1C0000",
      "size": 147954,
      "has_attachments": true,
      "attachments": [],
      "message_id": "61a673af22b14c1fac80ca45327156d3@saftco.ch",
      "in_reply_to": "GV0P278MB13205BD4F3C6FA221BD5D480F8A72@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "references": "<2d74ba4632304eeead353e365667e37a@saftco.ch>\r\n <GV0P278MB13201062BD016AE700CCDB85F8A72@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>\r\n <2e7b7f9495f0487199504ea286fc0b48@saftco.ch>\r\n <GV0P278MB13205BD4F3C6FA221BD5D480F8A72@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>"
    },
    {
      "subject": "RE: Issue Dnext API ",
      "from": "/O=EXCHANGELABS/OU=EXCHANGE ADMINISTRATIVE GROUP (FYDIBOHF23SPDLT)/CN=RECIPIENTS/CN=EC49082C17FD4A35889594A9C7ADF53D-30DE44D7-0A",
      "from_name": "Saber Khalfallah",
      "to": "Etienne Cornette",
      "cc": "Support Dnext",
      "received_time": "2025-03-25 12:14:34.546000+00:00",
      "sent_time": "2025-03-25 12:14:30+00:00",
      "body_text": "Hello Etienne ,\r\n\r\nwhen would you be available for a quick teams call so we can see this together ?\r\n\r\n \r\n\r\nBest regards \r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch> \r\nSent: Tuesday, March 25, 2025 12:09\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: RE: Issue Dnext API \r\n\r\n \r\n\r\nHello Saber,\r\n\r\n \r\n\r\nThanks much. \r\n\r\nUnfortunately, I still encounter the same error. \r\n\r\n \r\n\r\nEtienne \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Tuesday, March 25, 2025 9:46 AM\r\nTo: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Issue Dnext API \r\n\r\n \r\n\r\n*************************************Mail_Externe*********************************\r\n\r\n* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles. Signalez tout e-mail suspect à l'équipe service desk ou transmettez-le à l’adresse : itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information. Report any suspicious emails to the service desk team or forward them to: itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n******************************************************************************************\r\n\r\nHello Etienne,\r\n\r\n \r\n\r\nI hope you're doing well.\r\n\r\n \r\n\r\nIt appears that the password you entered in the script is incorrect. Below is the correct password:\r\n\r\n \r\n\r\nAPI Authentication Password: jgyH6564jijliuhçà_mkkjh\r\n\r\n \r\n\r\nPlease replace the current password in the script with this one, and everything should work as expected.\r\n\r\n \r\n\r\nLet me know how it goes.\r\n\r\n \r\n\r\nBest regards,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> > \r\nSent: Monday, March 24, 2025 19:18\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: Issue Dnext API \r\n\r\n \r\n\r\nHello Saber,\r\n\r\n \r\n\r\nHope all good. For some reason, I continue to struggle to connect to API  : \r\n\r\n \r\n\r\nCode below: \r\n\r\n \r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(\"https://api.dnext.io/v1.0/auth/custom-login?org= <https://api.dnext.io/v1.0/auth/custom-login?org=> \", env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(\"e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> \", \"jgyH6564jijliuhC'C _mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nResults : \r\n\r\n \r\n\r\n  \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><meta name=Generator content=\"Microsoft Word 15 (filtered medium)\"><!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n@font-face\r\n\t{font-family:Consolas;\r\n\tpanose-1:2 11 6 9 2 2 4 3 2 4;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:10.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle23\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style><!--[if gte mso 9]><xml>\r\n<o:shapedefaults v:ext=\"edit\" spidmax=\"1026\" />\r\n</xml><![endif]--><!--[if gte mso 9]><xml>\r\n<o:shapelayout v:ext=\"edit\">\r\n<o:idmap v:ext=\"edit\" data=\"1\" />\r\n</o:shapelayout></xml><![endif]--></head><body lang=EN-US link=\"#467886\" vlink=\"#96607D\" style='word-wrap:break-word'><div class=WordSection1><p class=MsoNormal><span style='font-size:12.0pt'>Hello Etienne ,<br><br>when would you be available for a quick teams call so we can see this together ?<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Best regards <o:p></o:p></span></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='color:#1F497D;mso-ligatures:standardcontextual'>Saber Khalfallah</span></b><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>Customer Support</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"_x0000_i1028\" src=\"cid:image001.png@01DB9D7F.5A3805F0\"></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| </span><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p></div><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'> Cornette Etienne &lt;e.cornette@saftco.ch&gt; <br><b>Sent:</b> Tuesday, March 25, 2025 12:09<br><b>To:</b> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;<br><b>Cc:</b> Support Dnext &lt;support@dnext.io&gt;<br><b>Subject:</b> RE: Issue Dnext API <o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style='font-size:11.0pt'>Hello Saber,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>Thanks much. <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>Unfortunately, I still encounter the same error. <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>Etienne <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt; <br><b>Sent:</b> Tuesday, March 25, 2025 9:46 AM<br><b>To:</b> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br><b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br><b>Subject:</b> RE: Issue Dnext API <o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p style='mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in'><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>*************************************Mail_Externe*********************************</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p style='mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in'><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles.&nbsp;Signalez tout e-mail suspect à l'équipe service desk ou transmettez-le à l’adresse : <a href=\"mailto:itsecurity@ocpgroup.ma\">itsecurity@ocpgroup.ma</a>.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p style='mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in'><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information.&nbsp;Report any suspicious emails to the service desk team or forward them to: <a href=\"mailto:itsecurity@ocpgroup.ma\">itsecurity@ocpgroup.ma</a>.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p style='mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in'><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>******************************************************************************************</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Hello Etienne,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>I hope you're doing well.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>It appears that the password you entered in the script is incorrect. Below is the correct password:<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>API Authentication Password</span></b><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>: jgyH6564jijliuhçà_mkkjh<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Please replace the current password in the script with this one, and everything should work as expected.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Let me know how it goes.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Best regards,<o:p></o:p></span></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='color:#1F497D;mso-ligatures:standardcontextual'>Saber Khalfallah</span></b><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>Customer Support</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:12.0pt;color:black;mso-ligatures:standardcontextual'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='font-size:9.0pt;color:blue'>saber.khalfallah@dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"x_x_Image_x0020_1\" src=\"cid:image001.png@01DB9D7F.5A3805F0\"></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:12.0pt;color:black;mso-ligatures:standardcontextual'><a href=\"mailto:info@dnext.io\"><span style='font-size:9.0pt;color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| </span><span style='font-size:12.0pt;color:black;mso-ligatures:standardcontextual'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='font-size:9.0pt;color:blue'>www.dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p></div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt; <br><b>Sent:</b> Monday, March 24, 2025 19:18<br><b>To:</b> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;<br><b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br><b>Subject:</b> Issue Dnext API <o:p></o:p></span></p></div></div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>Hello Saber,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>Hope all good. For some reason, I continue to struggle to connect to API&nbsp; : <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>Code below: <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Load required libraries <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>library(httr) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>library(jsonlite)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>library(readr)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Function to login to API and get token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>connect &lt;- function(email, pwd, env) { <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# email: email used to connect to your dnext environment <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# pwd: password <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV' <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Construct the URL <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;</span><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>url &lt;- paste0(&quot;</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\"><span lang=FR style='font-size:11.0pt'>https://api.dnext.io/v1.0/auth/custom-login?org=</span></a></span><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>&quot;, env) <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;</span><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Create the payload <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;payload &lt;- toJSON(list( <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;email = email, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;password = pwd, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;organization = env <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;), auto_unbox = TRUE) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Set the headers <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json') <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Send the POST request <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Parse the response and extract the token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;token &lt;- content(response)$token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;return(token) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>} <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Call the connect function with your credentials <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>token &lt;- connect(&quot;</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><a href=\"mailto:e.cornette@saftco.ch\"><span style='font-size:11.0pt'>e.cornette@saftco.ch</span></a></span><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&quot;, &quot;jgyH6564jijliuhC'C _mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>token<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<b>while</b> (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <b>else</b> <b>if</b> (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>break</b>&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (!success) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;return(success)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Function to download dataset<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>download_dataset &lt;- function(code, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<b>if</b> (is.null(res_json$task$id)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<b>if</b> (data_ready) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <b>if</b> (!is.null(res_json$result$url)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (data_resp$status_code == 200) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <b>else</b> {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; } <b>else</b> {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; } <b>else</b> {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;return(df)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Example usage<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Debug: Print dataset preview if successful<o:p></o:p></span></p><p class=MsoNormal><b><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>if</span></b><span style='font-size:11.0pt;mso-ligatures:standardcontextual'> (!is.null(df)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(head(df))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>} <b>else</b> {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>Results : <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><img border=0 width=374 height=182 style='width:3.9in;height:1.9in' id=\"_x0000_i1026\" src=\"cid:image002.png@01DB9D7F.5A3805F0\"></span><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Best regards,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Etienne Cornette<o:p></o:p></span></b></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Grains Trader<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>==============<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>SAFTCO SA <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Rue du Mont-Blanc 3,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>1201 GENEVA – CH<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><img border=0 width=160 height=121 style='width:1.6666in;height:1.2583in' id=\"Picture_x0020_1\" src=\"cid:image003.png@01DB9D7F.5A3805F0\"></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>------------------------------DISCLAIMER------------------------------------</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>------------------------------DISCLAIMER------------------------------------</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p></div></body></html>",
      "conversation_id": "D66AD69D9FC3402A9C4625D1A43DAA8F",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD4900028B5F2A1B0000",
      "size": 133774,
      "has_attachments": true,
      "attachments": [],
      "message_id": "GV0P278MB13205BD4F3C6FA221BD5D480F8A72@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "in_reply_to": "2e7b7f9495f0487199504ea286fc0b48@saftco.ch",
      "references": "<2d74ba4632304eeead353e365667e37a@saftco.ch>\r\n <GV0P278MB13201062BD016AE700CCDB85F8A72@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>\r\n <2e7b7f9495f0487199504ea286fc0b48@saftco.ch>"
    },
    {
      "subject": "RE: Issue Dnext API ",
      "from": "e.cornette@saftco.ch",
      "from_name": "Cornette Etienne",
      "to": "Saber Khalfallah",
      "cc": "Support Dnext",
      "received_time": "2025-03-25 12:09:24.197000+00:00",
      "sent_time": "2025-03-25 12:08:40+00:00",
      "body_text": "Hello Saber,\r\n\r\n \r\n\r\nThanks much. \r\n\r\nUnfortunately, I still encounter the same error. \r\n\r\n \r\n\r\nEtienne \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io> \r\nSent: Tuesday, March 25, 2025 9:46 AM\r\nTo: Cornette Etienne <e.cornette@saftco.ch>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: RE: Issue Dnext API \r\n\r\n \r\n\r\n*************************************Mail_Externe*********************************\r\n\r\n* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles. Signalez tout e-mail suspect à l'équipe service desk ou transmettez-le à l’adresse : itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information. Report any suspicious emails to the service desk team or forward them to: itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n******************************************************************************************\r\n\r\nHello Etienne,\r\n\r\n \r\n\r\nI hope you're doing well.\r\n\r\n \r\n\r\nIt appears that the password you entered in the script is incorrect. Below is the correct password:\r\n\r\n \r\n\r\nAPI Authentication Password: jgyH6564jijliuhçà_mkkjh\r\n\r\n \r\n\r\nPlease replace the current password in the script with this one, and everything should work as expected.\r\n\r\n \r\n\r\nLet me know how it goes.\r\n\r\n \r\n\r\nBest regards,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> > \r\nSent: Monday, March 24, 2025 19:18\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: Issue Dnext API \r\n\r\n \r\n\r\nHello Saber,\r\n\r\n \r\n\r\nHope all good. For some reason, I continue to struggle to connect to API  : \r\n\r\n \r\n\r\nCode below: \r\n\r\n \r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(\"https://api.dnext.io/v1.0/auth/custom-login?org= <https://api.dnext.io/v1.0/auth/custom-login?org=> \", env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(\"e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> \", \"jgyH6564jijliuhC'C _mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nResults : \r\n\r\n \r\n\r\n  \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head>\r\n\r\n<meta name=\"Generator\" content=\"Microsoft Word 15 (filtered medium)\">\r\n<!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n@font-face\r\n\t{font-family:Consolas;\r\n\tpanose-1:2 11 6 9 2 2 4 3 2 4;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:10.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle23\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style><!--[if gte mso 9]><xml>\r\n<o:shapedefaults v:ext=\"edit\" spidmax=\"1026\" />\r\n</xml><![endif]--><!--[if gte mso 9]><xml>\r\n<o:shapelayout v:ext=\"edit\">\r\n<o:idmap v:ext=\"edit\" data=\"1\" />\r\n</o:shapelayout></xml><![endif]-->\r\n</head>\r\n<body lang=\"EN-US\" link=\"#467886\" vlink=\"#96607D\" style=\"word-wrap:break-word\">\r\n<div class=\"WordSection1\">\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Hello Saber,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Thanks much. <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Unfortunately, I still encounter the same error.\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Etienne <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;\r\n<br>\r\n<b>Sent:</b> Tuesday, March 25, 2025 9:46 AM<br>\r\n<b>To:</b> Cornette Etienne &lt;e.cornette@saftco.ch&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;support@dnext.io&gt;<br>\r\n<b>Subject:</b> RE: Issue Dnext API <o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><o:p>&nbsp;</o:p></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">*************************************Mail_Externe*********************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles.&nbsp;Signalez tout e-mail suspect\r\n à l'équipe service desk ou transmettez-le à l’adresse : <a href=\"mailto:itsecurity@ocpgroup.ma\">\r\nitsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information.&nbsp;Report any suspicious emails to the service desk team or forward them to:\r\n<a href=\"mailto:itsecurity@ocpgroup.ma\">itsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">******************************************************************************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Hello Etienne,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">I hope you're doing well.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">It appears that the password you entered in the script is incorrect. Below is the correct password:<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">API Authentication Password</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">: jgyH6564jijliuhçà_mkkjh<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Please replace the current password in the script with this one, and everything should work as expected.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Let me know how it goes.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Best regards,<o:p></o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background:white;border-collapse:collapse\">\r\n<tbody>\r\n<tr style=\"height:31.0pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<b><span style=\"color:#1F497D;mso-ligatures:standardcontextual\">Saber Khalfallah</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">Customer Support</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"top\" style=\"width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" align=\"right\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size:12.0pt;color:black;mso-ligatures:standardcontextual\"><a href=\"mailto:saber.khalfallah@dnext.io\"><span style=\"font-size:9.0pt;color:blue\">saber.khalfallah@dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n<tr style=\"height:64.5pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<span style=\"font-size:11.0pt;color:#242424\"><img border=\"0\" width=\"73\" height=\"80\" style=\"width:.7583in;height:.8333in\" id=\"x_x_Image_x0020_1\" src=\"cid:image001.png@01DB9D7E.A2B124C0\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"bottom\" style=\"width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">DNEXT INTELLIGENCE SA\r\n</span></b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;color:black;mso-ligatures:standardcontextual\"><a href=\"mailto:info@dnext.io\"><span style=\"font-size:9.0pt;color:blue\">info@dnext.io</span></a></span><span style=\"font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual\">&nbsp;</span><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">|\r\n</span><span style=\"font-size:12.0pt;color:black;mso-ligatures:standardcontextual\"><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style=\"font-size:9.0pt;color:blue\">www.dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;\r\n<br>\r\n<b>Sent:</b> Monday, March 24, 2025 19:18<br>\r\n<b>To:</b> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> Issue Dnext API <o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Hello Saber,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Hope all good. For some reason, I continue to struggle to connect to API&nbsp; :\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Code below:\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Load required libraries\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(httr)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(jsonlite)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(readr)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Function to login to API and get token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">connect &lt;- function(email, pwd, env) {\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# email: email used to connect to your dnext environment\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# pwd: password\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV'\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Construct the URL\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;</span><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">url &lt;- paste0(&quot;</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\"><span lang=\"FR\" style=\"font-size:11.0pt\">https://api.dnext.io/v1.0/auth/custom-login?org=</span></a></span><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&quot;,\r\n env) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;</span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Create the payload\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;payload &lt;- toJSON(list(\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;email = email,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;password = pwd,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;organization = env\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;), auto_unbox = TRUE)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Set the headers\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json')\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Send the POST request\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Parse the response and extract the token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;token &lt;- content(response)$token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(token)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Call the connect function with your credentials\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">token &lt;- connect(&quot;</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><a href=\"mailto:e.cornette@saftco.ch\"><span style=\"font-size:11.0pt\">e.cornette@saftco.ch</span></a></span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&quot;,\r\n &quot;jgyH6564jijliuhC'C _mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">token<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<b>while</b> (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\r\n<b>else</b> <b>if</b> (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<b>break</b>&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (!success) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(success)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Function to download dataset<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">download_dataset &lt;- function(code, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<b>if</b> (is.null(res_json$task$id)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<b>if</b> (data_ready) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<b>if</b> (!is.null(res_json$result$url)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (data_resp$status_code == 200) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\r\n<b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }\r\n<b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }\r\n<b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(df)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Example usage<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Debug: Print dataset preview if successful<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">if</span></b><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"> (!is.null(df)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(head(df))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}\r\n<b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Results :\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><img border=\"0\" width=\"374\" height=\"182\" style=\"width:3.9in;height:1.9in\" id=\"_x0000_i1026\" src=\"cid:image002.png@01DB9D7E.A2B124C0\"></span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Best regards,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Etienne Cornette<o:p></o:p></span></b></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Grains Trader<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">==============<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">SAFTCO SA\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Rue du Mont-Blanc 3,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">1201 GENEVA – CH<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><img border=\"0\" width=\"160\" height=\"121\" style=\"width:1.6666in;height:1.2583in\" id=\"Picture_x0020_1\" src=\"cid:image003.png@01DB9D7E.A2B124C0\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">------------------------------DISCLAIMER------------------------------------</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque\r\n forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce\r\n message s'avérait modifié ou falsifié.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this\r\n message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible\r\n to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n</body>\r\n</html>\r\n\r\n<table width=\"100%\"><tr><td bgcolor=\"#ffffff\"><font color=\"#000000\"><pre><p><span style=\"color: rgb(0, 112, 192);\">------------------------------DISCLAIMER------------------------------------</span></p><p><span style=\"color: rgb(0, 112, 192);\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span></p><p><span style=\"color: rgb(0, 112, 192);\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span></p></pre></font></td></tr></table>",
      "conversation_id": "D66AD69D9FC3402A9C4625D1A43DAA8F",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD4900028B5F2A1A0000",
      "size": 136713,
      "has_attachments": true,
      "attachments": [],
      "message_id": "2e7b7f9495f0487199504ea286fc0b48@saftco.ch",
      "in_reply_to": "GV0P278MB13201062BD016AE700CCDB85F8A72@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "references": "<2d74ba4632304eeead353e365667e37a@saftco.ch>\r\n <GV0P278MB13201062BD016AE700CCDB85F8A72@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>"
    },
    {
      "subject": "RE: Issue Dnext API ",
      "from": "/O=EXCHANGELABS/OU=EXCHANGE ADMINISTRATIVE GROUP (FYDIBOHF23SPDLT)/CN=RECIPIENTS/CN=EC49082C17FD4A35889594A9C7ADF53D-30DE44D7-0A",
      "from_name": "Saber Khalfallah",
      "to": "Etienne Cornette",
      "cc": "Support Dnext",
      "received_time": "2025-03-25 09:45:45.622000+00:00",
      "sent_time": "2025-03-25 09:45:41+00:00",
      "body_text": "Hello Etienne,\r\n\r\n \r\n\r\nI hope you're doing well.\r\n\r\n \r\n\r\nIt appears that the password you entered in the script is incorrect. Below is the correct password:\r\n\r\n \r\n\r\nAPI Authentication Password: jgyH6564jijliuhçà_mkkjh\r\n\r\n \r\n\r\nPlease replace the current password in the script with this one, and everything should work as expected.\r\n\r\n \r\n\r\nLet me know how it goes.\r\n\r\n \r\n\r\nBest regards,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch> \r\nSent: Monday, March 24, 2025 19:18\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: Issue Dnext API \r\n\r\n \r\n\r\nHello Saber,\r\n\r\n \r\n\r\nHope all good. For some reason, I continue to struggle to connect to API  : \r\n\r\n \r\n\r\nCode below: \r\n\r\n \r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(\"https://api.dnext.io/v1.0/auth/custom-login?org= <https://api.dnext.io/v1.0/auth/custom-login?org=> \", env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(\"e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> \", \"jgyH6564jijliuhC'C _mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nResults : \r\n\r\n \r\n\r\n  \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><meta name=Generator content=\"Microsoft Word 15 (filtered medium)\"><!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n@font-face\r\n\t{font-family:Consolas;\r\n\tpanose-1:2 11 6 9 2 2 4 3 2 4;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:12.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tmso-ligatures:standardcontextual;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle21\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style><!--[if gte mso 9]><xml>\r\n<o:shapedefaults v:ext=\"edit\" spidmax=\"1026\" />\r\n</xml><![endif]--><!--[if gte mso 9]><xml>\r\n<o:shapelayout v:ext=\"edit\">\r\n<o:idmap v:ext=\"edit\" data=\"1\" />\r\n</o:shapelayout></xml><![endif]--></head><body lang=EN-US link=\"#467886\" vlink=\"#96607D\" style='word-wrap:break-word'><div class=WordSection1><div><p class=MsoNormal>Hello Etienne,<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>I hope you're doing well.<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>It appears that the password you entered in the script is incorrect. Below is the correct password:<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><b>API Authentication Password</b>: jgyH6564jijliuhçà_mkkjh<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Please replace the current password in the script with this one, and everything should work as expected.<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Let me know how it goes.<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Best regards,<o:p></o:p></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='font-size:10.0pt;color:#1F497D'>Saber Khalfallah</span></b><o:p></o:p></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>Customer Support</span><o:p></o:p></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='color:black'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='font-size:9.0pt;color:blue'>saber.khalfallah@dnext.io</span></a></span><o:p></o:p></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424;mso-ligatures:none'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"x_x_Image_x0020_1\" src=\"cid:image003.png@01DB9D69.247E5E70\"></span><o:p></o:p></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><o:p></o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='color:black'><a href=\"mailto:info@dnext.io\"><span style='font-size:9.0pt;color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D'>| </span><span style='color:black'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='font-size:9.0pt;color:blue'>www.dnext.io</span></a></span><o:p></o:p></p></td></tr></table><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'> Cornette Etienne &lt;e.cornette@saftco.ch&gt; <br><b>Sent:</b> Monday, March 24, 2025 19:18<br><b>To:</b> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;<br><b>Cc:</b> Support Dnext &lt;support@dnext.io&gt;<br><b>Subject:</b> Issue Dnext API <o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style='font-size:11.0pt'>Hello Saber,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>Hope all good. For some reason, I continue to struggle to connect to API&nbsp; : <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>Code below: <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Load required libraries <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(httr) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(jsonlite)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(readr)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Function to login to API and get token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>connect &lt;- function(email, pwd, env) { <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# email: email used to connect to your dnext environment <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# pwd: password <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV' <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Construct the URL <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;</span><span lang=FR style='font-size:11.0pt'>url &lt;- paste0(&quot;</span><a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\"><span lang=FR style='font-size:11.0pt'>https://api.dnext.io/v1.0/auth/custom-login?org=</span></a><span lang=FR style='font-size:11.0pt'>&quot;, env) <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>&nbsp;&nbsp;</span><span style='font-size:11.0pt'># Create the payload <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;payload &lt;- toJSON(list( <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;email = email, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;password = pwd, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;organization = env <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;), auto_unbox = TRUE) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Set the headers <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json') <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Send the POST request <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Parse the response and extract the token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;token &lt;- content(response)$token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(token) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>} <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Call the connect function with your credentials <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>token &lt;- connect(&quot;</span><a href=\"mailto:e.cornette@saftco.ch\"><span style='font-size:11.0pt'>e.cornette@saftco.ch</span></a><span style='font-size:11.0pt'>&quot;, &quot;jgyH6564jijliuhC'C _mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>token<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<b>while</b> (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <b>else</b> <b>if</b> (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>break</b>&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (!success) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(success)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Function to download dataset<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>download_dataset &lt;- function(code, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<b>if</b> (is.null(res_json$task$id)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<b>if</b> (data_ready) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <b>if</b> (!is.null(res_json$result$url)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (data_resp$status_code == 200) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <b>else</b> {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; } <b>else</b> {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; } <b>else</b> {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(df)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Example usage<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Debug: Print dataset preview if successful<o:p></o:p></span></p><p class=MsoNormal><b><span style='font-size:11.0pt'>if</span></b><span style='font-size:11.0pt'> (!is.null(df)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(head(df))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>} <b>else</b> {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>Results : <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:none'><img border=0 width=374 height=182 style='width:3.9in;height:1.9in' id=\"Picture_x0020_2\" src=\"cid:image004.png@01DB9D69.247E5E70\"></span><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal>Best regards,<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><b>Etienne Cornette<o:p></o:p></b></p><p class=MsoNormal>Grains Trader<o:p></o:p></p><p class=MsoNormal>==============<o:p></o:p></p><p class=MsoNormal>SAFTCO SA <o:p></o:p></p><p class=MsoNormal>Rue du Mont-Blanc 3,<o:p></o:p></p><p class=MsoNormal>1201 GENEVA – CH<o:p></o:p></p><p class=MsoNormal><span style='mso-ligatures:none'><img border=0 width=160 height=121 style='width:1.6666in;height:1.2583in' id=\"Picture_x0020_1\" src=\"cid:image005.png@01DB9D69.247E5E70\"></span><o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>------------------------------DISCLAIMER------------------------------------</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='mso-ligatures:none'><o:p>&nbsp;</o:p></span></p></div></body></html>",
      "conversation_id": "D66AD69D9FC3402A9C4625D1A43DAA8F",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD4900028B5F2A0B0000",
      "size": 115965,
      "has_attachments": true,
      "attachments": [],
      "message_id": "GV0P278MB13201062BD016AE700CCDB85F8A72@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "in_reply_to": "2d74ba4632304eeead353e365667e37a@saftco.ch",
      "references": "<2d74ba4632304eeead353e365667e37a@saftco.ch>"
    },
    {
      "subject": "Issue Dnext API ",
      "from": "e.cornette@saftco.ch",
      "from_name": "Cornette Etienne",
      "to": "Saber Khalfallah",
      "cc": "Support Dnext",
      "received_time": "2025-03-24 19:18:56.528000+00:00",
      "sent_time": "2025-03-24 19:18:07+00:00",
      "body_text": "Hello Saber,\r\n\r\n \r\n\r\nHope all good. For some reason, I continue to struggle to connect to API  : \r\n\r\n \r\n\r\nCode below: \r\n\r\n \r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(\"https://api.dnext.io/v1.0/auth/custom-login?org=\", env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(\"e.cornette@saftco.ch\", \"jgyH6564jijliuhC'C _mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nResults : \r\n\r\n \r\n\r\n  \r\n\r\n \r\n\r\n \r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head>\r\n\r\n<meta name=\"Generator\" content=\"Microsoft Word 15 (filtered medium)\">\r\n<!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:12.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tmso-ligatures:standardcontextual;}\r\nspan.EmailStyle17\r\n\t{mso-style-type:personal-compose;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style><!--[if gte mso 9]><xml>\r\n<o:shapedefaults v:ext=\"edit\" spidmax=\"1026\" />\r\n</xml><![endif]--><!--[if gte mso 9]><xml>\r\n<o:shapelayout v:ext=\"edit\">\r\n<o:idmap v:ext=\"edit\" data=\"1\" />\r\n</o:shapelayout></xml><![endif]-->\r\n</head>\r\n<body lang=\"EN-US\" link=\"#467886\" vlink=\"#96607D\" style=\"word-wrap:break-word\">\r\n<div class=\"WordSection1\">\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Hello Saber,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Hope all good. For some reason, I continue to struggle to connect to API&nbsp; :\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Code below: <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"># Load required libraries <o:p>\r\n</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">library(httr) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">library(jsonlite)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">library(readr)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"># Function to login to API and get token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">connect &lt;- function(email, pwd, env) {\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;# email: email used to connect to your dnext environment\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;# pwd: password <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV'\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;# Construct the URL <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;</span><span lang=\"FR\" style=\"font-size:11.0pt\">url &lt;- paste0(&quot;https://api.dnext.io/v1.0/auth/custom-login?org=&quot;, env)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">&nbsp;&nbsp;</span><span style=\"font-size:11.0pt\"># Create the payload\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;payload &lt;- toJSON(list( <o:p>\r\n</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;email = email, <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;password = pwd, <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;organization = env <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;), auto_unbox = TRUE) <o:p>\r\n</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;# Set the headers <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json')\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;# Send the POST request <o:p>\r\n</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;# Parse the response and extract the token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;token &lt;- content(response)$token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;return(token) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">} <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"># Call the connect function with your credentials\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">token &lt;- connect(&quot;e.cornette@saftco.ch&quot;, &quot;jgyH6564jijliuhC'C _mkkjh&quot;, &quot;saftco&quot;)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">token<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;<b>while</b> (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <b>else</b> <b>if</b> (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>break</b>&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (!success) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;return(success)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"># Function to download dataset<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">download_dataset &lt;- function(code, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;<b>if</b> (is.null(res_json$task$id)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;<b>if</b> (data_ready) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; <b>if</b> (!is.null(res_json$result$url)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b>if</b> (data_resp$status_code == 200) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } <b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; } <b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; } <b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp;&nbsp;return(df)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"># Example usage<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"># Debug: Print dataset preview if successful<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt\">if</span></b><span style=\"font-size:11.0pt\"> (!is.null(df)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; print(head(df))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">} <b>else</b> {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Results : <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><img width=\"374\" height=\"182\" style=\"width:3.9in;height:1.9in\" id=\"_x0000_i1026\" src=\"cid:image001.png@01DB9CF1.76AF8F70\"></span><span style=\"font-size:11.0pt\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\">Best regards,<o:p></o:p></p>\r\n<p class=\"MsoNormal\"><o:p>&nbsp;</o:p></p>\r\n<p class=\"MsoNormal\"><b>Etienne Cornette<o:p></o:p></b></p>\r\n<p class=\"MsoNormal\">Grains Trader<o:p></o:p></p>\r\n<p class=\"MsoNormal\">==============<o:p></o:p></p>\r\n<p class=\"MsoNormal\">SAFTCO SA <o:p></o:p></p>\r\n<p class=\"MsoNormal\">Rue du Mont-Blanc 3,<o:p></o:p></p>\r\n<p class=\"MsoNormal\">1201 GENEVA – CH<o:p></o:p></p>\r\n<p class=\"MsoNormal\"><img width=\"160\" height=\"121\" style=\"width:1.6666in;height:1.2583in\" id=\"Picture_x0020_1\" src=\"cid:image002.png@01DB9CF1.76AF8F70\"><o:p></o:p></p>\r\n<p class=\"MsoNormal\"><o:p>&nbsp;</o:p></p>\r\n</div>\r\n</body>\r\n</html>\r\n\r\n<table width=\"100%\"><tr><td bgcolor=\"#ffffff\"><font color=\"#000000\"><pre><p><span style=\"color: rgb(0, 112, 192);\">------------------------------DISCLAIMER------------------------------------</span></p><p><span style=\"color: rgb(0, 112, 192);\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span></p><p><span style=\"color: rgb(0, 112, 192);\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span></p></pre></font></td></tr></table>\r\n",
      "conversation_id": "D66AD69D9FC3402A9C4625D1A43DAA8F",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD4900028B5F2A070000",
      "size": 137231,
      "has_attachments": true,
      "attachments": [],
      "message_id": "2d74ba4632304eeead353e365667e37a@saftco.ch",
      "in_reply_to": null,
      "references": null
    }
  ],
  "subject": "RE: Issue Dnext API "
}