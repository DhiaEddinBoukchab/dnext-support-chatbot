{
  "emails": [
    {
      "subject": "RE: Problème pour DL freight database",
      "from": "e.cornette@saftco.ch",
      "from_name": "Cornette Etienne",
      "to": "Saber Khalfallah",
      "cc": "Support Dnext",
      "received_time": "2025-10-03 11:21:53.202000+00:00",
      "sent_time": "2025-10-03 11:21:22+00:00",
      "body_text": "Hello please disregard my previous email.\r\n\r\n \r\n\r\nEtienne \r\n\r\n \r\n\r\nFrom: Cornette Etienne \r\nSent: Friday, October 3, 2025 12:00 PM\r\nTo: 'Saber Khalfallah' <saber.khalfallah@dnext.io>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Saber,\r\n\r\n \r\n\r\nMerci pour ta prompte réponse. Le script est bon. \r\n\r\n \r\n\r\nCependant, pour des raisons inconnues, le script tourne depuis 15 min et je n’ai aucun résultat.\r\n\r\n \r\n\r\n\r\n\r\n \r\n\r\nChokrane bzef,\r\n\r\n \r\n\r\nEtienne\r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Tuesday, September 30, 2025 12:27 PM\r\nTo: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\n*************************************Mail_Externe*********************************\r\n\r\n* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles. Signalez tout e-mail suspect à l'équipe service desk ou transmettez-le à l’adresse : itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information. Report any suspicious emails to the service desk team or forward them to: itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n******************************************************************************************\r\n\r\nBonjour Etienne,\r\n\r\n \r\n\r\nJ’espére que vous allez bien.\r\n\r\nJe reviens vers vous concernant le script corrigé que je vous ai transmis hier.\r\n\r\n \r\n\r\nAvez-vous pu le tester de votre côté et est-ce que tout fonctionne désormais correctement pour le téléchargement de la dataset freight ?\r\n\r\n \r\n\r\nN’hésitez pas à me dire si vous rencontrez encore des soucis, je reste disponible pour vous aider.\r\n\r\n \r\n\r\nCordialement,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Monday, September 29, 2025 13:29\r\nTo: Etienne Cornette <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Etienne\r\n\r\n\r\nil y’avait quelques fautes des syntax que j’ai corrigé et j’ai testé le script , sa fonctionnait chez moi sans soucis .\r\nvous trouverez ci-dessous le script corrigé :\r\n\r\nQuote \r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\nUnquote\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Monday, September 29, 2025 13:12\r\nTo: Etienne Cornette <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Etienne,\r\n\r\n \r\n\r\nMerci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.\r\n\r\n \r\n\r\nCordialement\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> > \r\nSent: Monday, September 29, 2025 12:46\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> >\r\nSubject: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Saber,\r\n\r\n \r\n\r\nJ’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.\r\n\r\n \r\n\r\nMon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.\r\n\r\n \r\n\r\nPeux tu m’aider stp ? \r\n\r\n \r\n\r\n \r\n\r\nQuote :\r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head>\r\n\r\n<meta name=\"Generator\" content=\"Microsoft Word 15 (filtered medium)\">\r\n<!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:10.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle21\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style>\r\n</head>\r\n<body lang=\"EN-US\" link=\"#467886\" vlink=\"#96607D\" style=\"word-wrap:break-word\">\r\n<div class=\"WordSection1\">\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Hello please disregard my previous email.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Etienne <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Cornette Etienne\r\n<br>\r\n<b>Sent:</b> Friday, October 3, 2025 12:00 PM<br>\r\n<b>To:</b> 'Saber Khalfallah' &lt;saber.khalfallah@dnext.io&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;support@dnext.io&gt;<br>\r\n<b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><o:p>&nbsp;</o:p></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Bonjour Saber,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">Merci pour ta prompte réponse. Le script est bon.\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">Cependant, pour des raisons inconnues, le script tourne depuis 15 min et je n’ai aucun résultat.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><img width=\"894\" height=\"170\" style=\"width:9.3083in;height:1.775in\" id=\"_x0000_i1029\" src=\"cid:image003.png@01DC3460.3C1312E0\"></span><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">Chokrane bzef,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">Etienne<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;\r\n<br>\r\n<b>Sent:</b> Tuesday, September 30, 2025 12:27 PM<br>\r\n<b>To:</b> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><o:p>&nbsp;</o:p></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">*************************************Mail_Externe*********************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles.&nbsp;Signalez tout e-mail suspect\r\n à l'équipe service desk ou transmettez-le à l’adresse : <a href=\"mailto:itsecurity@ocpgroup.ma\">\r\nitsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information.&nbsp;Report any suspicious emails to the service desk team or forward them to:\r\n<a href=\"mailto:itsecurity@ocpgroup.ma\">itsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">******************************************************************************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Bonjour Etienne,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"margin-bottom:12.0pt\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">J’espére que vous allez bien.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Je reviens vers vous concernant le script corrigé que je vous ai transmis hier.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Avez-vous pu le tester de votre côté et est-ce que tout fonctionne désormais correctement pour le téléchargement de la dataset freight ?<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">N’hésitez pas à me dire si vous rencontrez encore des soucis, je reste disponible pour vous aider.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Cordialement,<o:p></o:p></span></p>\r\n<div>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background:white;border-collapse:collapse\">\r\n<tbody>\r\n<tr style=\"height:31.0pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<b><span style=\"color:#1F497D;mso-ligatures:standardcontextual\">Saber Khalfallah</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">Customer Support</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"top\" style=\"width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" align=\"right\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual\"><a href=\"mailto:saber.khalfallah@dnext.io\"><span style=\"color:blue\">saber.khalfallah@dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n<tr style=\"height:64.5pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<span style=\"font-size:11.0pt;color:#242424\"><img border=\"0\" width=\"73\" height=\"80\" style=\"width:.7583in;height:.8333in\" id=\"Picture_x0020_2\" src=\"cid:image004.png@01DC3460.3C1312E0\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"bottom\" style=\"width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">DNEXT INTELLIGENCE SA\r\n</span></b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"mailto:info@dnext.io\"><span style=\"color:blue\">info@dnext.io</span></a></span><span style=\"font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual\">&nbsp;</span><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">|\r\n</span><span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style=\"color:blue\">www.dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div style=\"border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt\">\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;\r\n<br>\r\n<b>Sent:</b> Monday, September 29, 2025 13:29<br>\r\n<b>To:</b> Etienne Cornette &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Bonjour Etienne<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><br>\r\nil y’avait quelques fautes des syntax que j’ai corrigé et j’ai testé le script , sa fonctionnait chez moi sans soucis .<br>\r\nvous trouverez ci-dessous le script corrigé :<o:p></o:p></span></p>\r\n<div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Quote\r\n<br>\r\n# Load required libraries <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">library(httr)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">library(jsonlite)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">library(readr)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Function to login to API and get token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">connect &lt;- function(email, pwd, env) {\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# email: email used to connect to your dnext environment\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# pwd: password\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV'\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Construct the URL\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>, env)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Create the payload\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;payload &lt;- toJSON(list(\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;email = email,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;password = pwd,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;organization = env\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;), auto_unbox = TRUE)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Set the headers\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json')\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Send the POST request\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Parse the response and extract the token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;token &lt;- content(response)$token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(token)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">}\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Call the connect function with your credentials\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">token &lt;- connect(<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>, &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">token<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(success)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Function to download dataset<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">download_dataset &lt;- function(code, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;if (data_ready) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(df)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Example usage<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Debug: Print dataset preview if successful<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">if (!is.null(df)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(head(df))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">} else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">}<br>\r\n<br>\r\nUnquote<o:p></o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background:white;border-collapse:collapse\">\r\n<tbody>\r\n<tr style=\"height:31.0pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<b><span style=\"color:#1F497D;mso-ligatures:standardcontextual\">Saber Khalfallah</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">Customer Support</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"top\" style=\"width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" align=\"right\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual\"><a href=\"mailto:saber.khalfallah@dnext.io\"><span style=\"color:blue\">saber.khalfallah@dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n<tr style=\"height:64.5pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<span style=\"font-size:11.0pt;color:#242424\"><img border=\"0\" width=\"73\" height=\"80\" style=\"width:.7583in;height:.8333in\" id=\"_x0000_i1027\" src=\"cid:image004.png@01DC3460.3C1312E0\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"bottom\" style=\"width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">DNEXT INTELLIGENCE SA\r\n</span></b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"mailto:info@dnext.io\"><span style=\"color:blue\">info@dnext.io</span></a></span><span style=\"font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual\">&nbsp;</span><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">|\r\n</span><span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style=\"color:blue\">www.dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div style=\"border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt\">\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;\r\n<br>\r\n<b>Sent:</b> Monday, September 29, 2025 13:12<br>\r\n<b>To:</b> Etienne Cornette &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Bonjour Etienne,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Merci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Cordialement<o:p></o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background:white;border-collapse:collapse\">\r\n<tbody>\r\n<tr style=\"height:31.0pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<b><span style=\"color:#1F497D;mso-ligatures:standardcontextual\">Saber Khalfallah</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">Customer Support</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"top\" style=\"width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" align=\"right\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual\"><a href=\"mailto:saber.khalfallah@dnext.io\"><span style=\"color:blue\">saber.khalfallah@dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n<tr style=\"height:64.5pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<span style=\"font-size:11.0pt;color:#242424\"><img border=\"0\" width=\"73\" height=\"80\" style=\"width:.7583in;height:.8333in\" id=\"x_x_Image_x0020_1\" src=\"cid:image004.png@01DC3460.3C1312E0\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"bottom\" style=\"width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">DNEXT INTELLIGENCE SA\r\n</span></b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"mailto:info@dnext.io\"><span style=\"color:blue\">info@dnext.io</span></a></span><span style=\"font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual\">&nbsp;</span><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">|\r\n</span><span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style=\"color:blue\">www.dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;\r\n<br>\r\n<b>Sent:</b> Monday, September 29, 2025 12:46<br>\r\n<b>To:</b> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> Problème pour DL freight database<o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Bonjour Saber,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">J’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Mon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Peux tu m’aider stp&nbsp;?\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Quote&nbsp;:<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Load required libraries\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(httr)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(jsonlite)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(readr)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Function to login to API and get token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">connect &lt;- function(email, pwd, env) {\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# email: email used to connect to your dnext environment\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# pwd: password\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV'\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Construct the URL\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;</span><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>,\r\n env) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;</span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Create the payload\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;payload &lt;- toJSON(list(\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;email = email,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;password = pwd,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;organization = env\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;), auto_unbox = TRUE)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Set the headers\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json')\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Send the POST request\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Parse the response and extract the token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;token &lt;- content(response)$token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(token)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Call the connect function with your credentials\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">token &lt;- connect(</span><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><a href=\"mailto:e.cornette@saftco.ch\"><span lang=\"EN-US\">e.cornette@saftco.ch</span></a></span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">,\r\n &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">token<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(success)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Function to download dataset<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">download_dataset &lt;- function(code, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;if (data_ready) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(df)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Example usage<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Debug: Print dataset preview if successful<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">if (!is.null(df)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(head(df))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">} else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Best regards,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><b><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Etienne Cornette<o:p></o:p></span></b></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Grains Trader<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">==============<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">SAFTCO SA\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Rue du Mont-Blanc 3,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">1201 GENEVA – CH<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><img border=\"0\" width=\"160\" height=\"121\" style=\"width:1.6666in;height:1.2583in\" id=\"Picture_x0020_1\" src=\"cid:image005.png@01DC3460.3C1312E0\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">------------------------------DISCLAIMER------------------------------------</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque\r\n forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce\r\n message s'avérait modifié ou falsifié.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this\r\n message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible\r\n to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n</div>\r\n</div>\r\n</body>\r\n</html>\r\n\r\n<table width=\"100%\"><tr><td bgcolor=\"#ffffff\"><font color=\"#000000\"><pre><p><span style=\"color: rgb(0, 112, 192);\">------------------------------DISCLAIMER------------------------------------</span></p><p><span style=\"color: rgb(0, 112, 192);\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span></p><p><span style=\"color: rgb(0, 112, 192);\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span></p></pre></font></td></tr></table>",
      "conversation_id": "EA341D1AB7064740B3085892A4F20065",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD4900030A5BAC940000",
      "size": 171950,
      "has_attachments": true,
      "attachments": [],
      "message_id": "5b2bef6be923454ba5a9fe6988f52b80@saftco.ch",
      "in_reply_to": "711bab8049c245f5a7c710e50d1f9254@saftco.ch",
      "references": "<59a2080543d34b4fbf24644843f15c8e@saftco.ch>\r\n <GV0P278MB1320142AF7EB26FB16C100F1F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>\r\n <GV0P278MB1320ED4DB163DBAF677C9C83F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>\r\n <ZR3P278MB1323FD93A42F23A87D6A7493F81AA@ZR3P278MB1323.CHEP278.PROD.OUTLOOK.COM>\r\n <711bab8049c245f5a7c710e50d1f9254@saftco.ch>"
    },
    {
      "subject": "RE: Problème pour DL freight database",
      "from": "/O=EXCHANGELABS/OU=EXCHANGE ADMINISTRATIVE GROUP (FYDIBOHF23SPDLT)/CN=RECIPIENTS/CN=EC49082C17FD4A35889594A9C7ADF53D-30DE44D7-0A",
      "from_name": "Saber Khalfallah",
      "to": "Etienne Cornette",
      "cc": "Support Dnext",
      "received_time": "2025-10-03 11:06:16.387000+00:00",
      "sent_time": "2025-10-03 11:06:13+00:00",
      "body_text": "Bonjour Etienne,\r\n\r\n \r\n\r\nLa Freight Dataset est un peu large (5gb de taille je crois), c’est normal que sa prend un peu du temps. Si sa continue a tourner sans resultat n’hesitez pas a me le dire et on peut faire un quick call pour voir sa ensemble.\r\n\r\n \r\n\r\nMerci pour votre patience.\r\n\r\nCordialement\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch> \r\nSent: Friday, October 3, 2025 11:00\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Saber,\r\n\r\n \r\n\r\nMerci pour ta prompte réponse. Le script est bon. \r\n\r\n \r\n\r\nCependant, pour des raisons inconnues, le script tourne depuis 15 min et je n’ai aucun résultat.\r\n\r\n \r\n\r\n\r\n\r\n \r\n\r\nChokrane bzef,\r\n\r\n \r\n\r\nEtienne\r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Tuesday, September 30, 2025 12:27 PM\r\nTo: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\n*************************************Mail_Externe*********************************\r\n\r\n* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles. Signalez tout e-mail suspect à l'équipe service desk ou transmettez-le à l’adresse : itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information. Report any suspicious emails to the service desk team or forward them to: itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n******************************************************************************************\r\n\r\nBonjour Etienne,\r\n\r\n \r\n\r\nJ’espére que vous allez bien.\r\n\r\nJe reviens vers vous concernant le script corrigé que je vous ai transmis hier.\r\n\r\n \r\n\r\nAvez-vous pu le tester de votre côté et est-ce que tout fonctionne désormais correctement pour le téléchargement de la dataset freight ?\r\n\r\n \r\n\r\nN’hésitez pas à me dire si vous rencontrez encore des soucis, je reste disponible pour vous aider.\r\n\r\n \r\n\r\nCordialement,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Monday, September 29, 2025 13:29\r\nTo: Etienne Cornette <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Etienne\r\n\r\n\r\nil y’avait quelques fautes des syntax que j’ai corrigé et j’ai testé le script , sa fonctionnait chez moi sans soucis .\r\nvous trouverez ci-dessous le script corrigé :\r\n\r\nQuote \r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\nUnquote\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Monday, September 29, 2025 13:12\r\nTo: Etienne Cornette <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Etienne,\r\n\r\n \r\n\r\nMerci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.\r\n\r\n \r\n\r\nCordialement\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> > \r\nSent: Monday, September 29, 2025 12:46\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> >\r\nSubject: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Saber,\r\n\r\n \r\n\r\nJ’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.\r\n\r\n \r\n\r\nMon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.\r\n\r\n \r\n\r\nPeux tu m’aider stp ? \r\n\r\n \r\n\r\n \r\n\r\nQuote :\r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><meta name=Generator content=\"Microsoft Word 15 (filtered medium)\"><!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n@font-face\r\n\t{font-family:Consolas;\r\n\tpanose-1:2 11 6 9 2 2 4 3 2 4;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:10.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle23\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style></head><body lang=EN-US link=\"#467886\" vlink=\"#96607D\" style='word-wrap:break-word'><div class=WordSection1><p class=MsoNormal><span style='font-size:12.0pt'>Bonjour Etienne,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'>La Freight Dataset est un peu large (5gb de taille je crois), c’est normal que sa prend un peu du temps. Si sa continue a tourner sans resultat n’hesitez pas a me le dire et on peut faire un quick call pour voir sa ensemble.<o:p></o:p></span></p><div><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Merci pour votre patience.<br><br>Cordialement</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='color:#1F497D;mso-ligatures:standardcontextual'>Saber Khalfallah</span></b><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>Customer Support</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"_x0000_i1030\" src=\"cid:image001.png@01DC3455.B9327AF0\"></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| </span><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p></div><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'> Cornette Etienne &lt;e.cornette@saftco.ch&gt; <br><b>Sent:</b> Friday, October 3, 2025 11:00<br><b>To:</b> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;<br><b>Cc:</b> Support Dnext &lt;support@dnext.io&gt;<br><b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span style='font-size:11.0pt'>Bonjour Saber,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Merci pour ta prompte réponse. Le script est bon. <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Cependant, pour des raisons inconnues, le script tourne depuis 15 min et je n’ai aucun résultat.<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><img border=0 width=894 height=170 style='width:9.3083in;height:1.7666in' id=\"_x0000_i1029\" src=\"cid:image003.png@01DC3455.B9327AF0\"></span><span lang=FR style='font-size:11.0pt'><o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Chokrane bzef,<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Etienne<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt; <br><b>Sent:</b> Tuesday, September 30, 2025 12:27 PM<br><b>To:</b> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br><b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br><b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p style='mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in'><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>*************************************Mail_Externe*********************************</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p style='mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in'><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles.&nbsp;Signalez tout e-mail suspect à l'équipe service desk ou transmettez-le à l’adresse : <a href=\"mailto:itsecurity@ocpgroup.ma\">itsecurity@ocpgroup.ma</a>.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p style='mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in'><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information.&nbsp;Report any suspicious emails to the service desk team or forward them to: <a href=\"mailto:itsecurity@ocpgroup.ma\">itsecurity@ocpgroup.ma</a>.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p style='mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in'><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>******************************************************************************************</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Bonjour Etienne,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal style='margin-bottom:12.0pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>J’espére que vous allez bien.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Je reviens vers vous concernant le script corrigé que je vous ai transmis hier.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Avez-vous pu le tester de votre côté et est-ce que tout fonctionne désormais correctement pour le téléchargement de la dataset freight ?<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>N’hésitez pas à me dire si vous rencontrez encore des soucis, je reste disponible pour vous aider.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Cordialement,<o:p></o:p></span></p><div><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='color:#1F497D;mso-ligatures:standardcontextual'>Saber Khalfallah</span></b><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>Customer Support</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"Picture_x0020_2\" src=\"cid:image001.png@01DC3455.B9327AF0\"></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| </span><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p></div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><div style='border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt'><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt; <br><b>Sent:</b> Monday, September 29, 2025 13:29<br><b>To:</b> Etienne Cornette &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br><b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br><b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Bonjour Etienne<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><br>il y’avait quelques fautes des syntax que j’ai corrigé et j’ai testé le script , sa fonctionnait chez moi sans soucis .<br>vous trouverez ci-dessous le script corrigé :<o:p></o:p></span></p><div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Quote <br># Load required libraries <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>library(httr) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>library(jsonlite)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>library(readr)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'># Function to login to API and get token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>connect &lt;- function(email, pwd, env) { <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# email: email used to connect to your dnext environment <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# pwd: password <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV' <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Construct the URL <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>, env) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Create the payload <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;payload &lt;- toJSON(list( <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;email = email, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;password = pwd, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;organization = env <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;), auto_unbox = TRUE) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Set the headers <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json') <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Send the POST request <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Parse the response and extract the token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;token &lt;- content(response)$token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;return(token) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>} <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'># Call the connect function with your credentials <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>token &lt;- connect(<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>, &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>token<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;return(success)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'># Function to download dataset<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>download_dataset &lt;- function(code, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;if (data_ready) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;return(df)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'># Example usage<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'># Debug: Print dataset preview if successful<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>if (!is.null(df)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; print(head(df))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>} else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>}<br><br>Unquote<o:p></o:p></span></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='color:#1F497D;mso-ligatures:standardcontextual'>Saber Khalfallah</span></b><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>Customer Support</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"_x0000_i1027\" src=\"cid:image001.png@01DC3455.B9327AF0\"></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| </span><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p></div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><div style='border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt'><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt; <br><b>Sent:</b> Monday, September 29, 2025 13:12<br><b>To:</b> Etienne Cornette &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br><b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br><b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Bonjour Etienne,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Merci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>Cordialement<o:p></o:p></span></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='color:#1F497D;mso-ligatures:standardcontextual'>Saber Khalfallah</span></b><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>Customer Support</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"x_x_Image_x0020_1\" src=\"cid:image001.png@01DC3455.B9327AF0\"></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual'>| </span><span style='font-size:9.0pt;color:blue;mso-ligatures:standardcontextual'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p></div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif'> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt; <br><b>Sent:</b> Monday, September 29, 2025 12:46<br><b>To:</b> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;<br><b>Subject:</b> Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>Bonjour Saber,<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>J’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>Mon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>Peux tu m’aider stp&nbsp;? <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>Quote&nbsp;:<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Load required libraries <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>library(httr) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>library(jsonlite)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>library(readr)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Function to login to API and get token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>connect &lt;- function(email, pwd, env) { <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# email: email used to connect to your dnext environment <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# pwd: password <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV' <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Construct the URL <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;</span><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>, env) <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;</span><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Create the payload <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;payload &lt;- toJSON(list( <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;email = email, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;password = pwd, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;organization = env <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;), auto_unbox = TRUE) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Set the headers <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json') <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Send the POST request <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Parse the response and extract the token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;token &lt;- content(response)$token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;return(token) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>} <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Call the connect function with your credentials <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>token &lt;- connect(</span><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><a href=\"mailto:e.cornette@saftco.ch\"><span lang=EN-US>e.cornette@saftco.ch</span></a></span><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>, &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>token<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;return(success)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Function to download dataset<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>download_dataset &lt;- function(code, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;if (data_ready) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp;&nbsp;return(df)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Example usage<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'># Debug: Print dataset preview if successful<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>if (!is.null(df)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(head(df))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>} else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt;mso-ligatures:standardcontextual'>&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'>}<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:12.0pt;mso-ligatures:standardcontextual'>Best regards,<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b><span lang=FR style='font-size:12.0pt;mso-ligatures:standardcontextual'>Etienne Cornette<o:p></o:p></span></b></p><p class=MsoNormal><span lang=FR style='font-size:12.0pt;mso-ligatures:standardcontextual'>Grains Trader<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:12.0pt;mso-ligatures:standardcontextual'>==============<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:12.0pt;mso-ligatures:standardcontextual'>SAFTCO SA <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:12.0pt;mso-ligatures:standardcontextual'>Rue du Mont-Blanc 3,<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'>1201 GENEVA – CH<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt'><img border=0 width=160 height=121 style='width:1.6666in;height:1.2583in' id=\"Picture_x0020_1\" src=\"cid:image004.png@01DC3455.B9327AF0\"></span><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p></o:p></span></p><p class=MsoNormal><span style='font-size:12.0pt;mso-ligatures:standardcontextual'><o:p>&nbsp;</o:p></span></p><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>------------------------------DISCLAIMER------------------------------------</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p></div></div><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>------------------------------DISCLAIMER------------------------------------</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='font-size:12.0pt'><o:p>&nbsp;</o:p></span></p></div></body></html>",
      "conversation_id": "EA341D1AB7064740B3085892A4F20065",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD4900030A5BAC930000",
      "size": 172290,
      "has_attachments": true,
      "attachments": [],
      "message_id": "ZR3P278MB132373FFE8EC032DA02B11D9F8E4A@ZR3P278MB1323.CHEP278.PROD.OUTLOOK.COM",
      "in_reply_to": "711bab8049c245f5a7c710e50d1f9254@saftco.ch",
      "references": "<59a2080543d34b4fbf24644843f15c8e@saftco.ch>\r\n <GV0P278MB1320142AF7EB26FB16C100F1F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>\r\n <GV0P278MB1320ED4DB163DBAF677C9C83F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>\r\n <ZR3P278MB1323FD93A42F23A87D6A7493F81AA@ZR3P278MB1323.CHEP278.PROD.OUTLOOK.COM>\r\n <711bab8049c245f5a7c710e50d1f9254@saftco.ch>"
    },
    {
      "subject": "RE: Problème pour DL freight database",
      "from": "e.cornette@saftco.ch",
      "from_name": "Cornette Etienne",
      "to": "Saber Khalfallah",
      "cc": "Support Dnext",
      "received_time": "2025-10-03 11:00:39.742000+00:00",
      "sent_time": "2025-10-03 10:59:36+00:00",
      "body_text": "Bonjour Saber,\r\n\r\n \r\n\r\nMerci pour ta prompte réponse. Le script est bon. \r\n\r\n \r\n\r\nCependant, pour des raisons inconnues, le script tourne depuis 15 min et je n’ai aucun résultat.\r\n\r\n \r\n\r\n\r\n\r\n \r\n\r\nChokrane bzef,\r\n\r\n \r\n\r\nEtienne\r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io> \r\nSent: Tuesday, September 30, 2025 12:27 PM\r\nTo: Cornette Etienne <e.cornette@saftco.ch>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\n*************************************Mail_Externe*********************************\r\n\r\n* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles. Signalez tout e-mail suspect à l'équipe service desk ou transmettez-le à l’adresse : itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information. Report any suspicious emails to the service desk team or forward them to: itsecurity@ocpgroup.ma <mailto:itsecurity@ocpgroup.ma> .\r\n\r\n******************************************************************************************\r\n\r\nBonjour Etienne,\r\n\r\n \r\n\r\nJ’espére que vous allez bien.\r\n\r\nJe reviens vers vous concernant le script corrigé que je vous ai transmis hier.\r\n\r\n \r\n\r\nAvez-vous pu le tester de votre côté et est-ce que tout fonctionne désormais correctement pour le téléchargement de la dataset freight ?\r\n\r\n \r\n\r\nN’hésitez pas à me dire si vous rencontrez encore des soucis, je reste disponible pour vous aider.\r\n\r\n \r\n\r\nCordialement,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Monday, September 29, 2025 13:29\r\nTo: Etienne Cornette <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Etienne\r\n\r\n\r\nil y’avait quelques fautes des syntax que j’ai corrigé et j’ai testé le script , sa fonctionnait chez moi sans soucis .\r\nvous trouverez ci-dessous le script corrigé :\r\n\r\nQuote \r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\nUnquote\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Monday, September 29, 2025 13:12\r\nTo: Etienne Cornette <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Etienne,\r\n\r\n \r\n\r\nMerci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.\r\n\r\n \r\n\r\nCordialement\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> > \r\nSent: Monday, September 29, 2025 12:46\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> >\r\nSubject: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Saber,\r\n\r\n \r\n\r\nJ’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.\r\n\r\n \r\n\r\nMon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.\r\n\r\n \r\n\r\nPeux tu m’aider stp ? \r\n\r\n \r\n\r\n \r\n\r\nQuote :\r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head>\r\n\r\n<meta name=\"Generator\" content=\"Microsoft Word 15 (filtered medium)\">\r\n<!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n@font-face\r\n\t{font-family:Consolas;\r\n\tpanose-1:2 11 6 9 2 2 4 3 2 4;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:10.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle23\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style>\r\n</head>\r\n<body lang=\"EN-US\" link=\"#467886\" vlink=\"#96607D\" style=\"word-wrap:break-word\">\r\n<div class=\"WordSection1\">\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\">Bonjour Saber,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">Merci pour ta prompte réponse. Le script est bon.\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">Cependant, pour des raisons inconnues, le script tourne depuis 15 min et je n’ai aucun résultat.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><img width=\"894\" height=\"170\" style=\"width:9.3083in;height:1.775in\" id=\"_x0000_i1029\" src=\"cid:image003.png@01DC345D.2FE12780\"></span><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">Chokrane bzef,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\">Etienne<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;\r\n<br>\r\n<b>Sent:</b> Tuesday, September 30, 2025 12:27 PM<br>\r\n<b>To:</b> Cornette Etienne &lt;e.cornette@saftco.ch&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;support@dnext.io&gt;<br>\r\n<b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><o:p>&nbsp;</o:p></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">*************************************Mail_Externe*********************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Soyez prudent lorsque vous ouvrez des liens, des pièces jointes et lorsque vous êtes invité à entrer des mots de passe ou des informations confidentielles.&nbsp;Signalez tout e-mail suspect\r\n à l'équipe service desk ou transmettez-le à l’adresse : <a href=\"mailto:itsecurity@ocpgroup.ma\">\r\nitsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:7.5pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">* Be careful when opening links, attachments, and when prompted to enter passwords or confidential information.&nbsp;Report any suspicious emails to the service desk team or forward them to:\r\n<a href=\"mailto:itsecurity@ocpgroup.ma\">itsecurity@ocpgroup.ma</a>.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p style=\"mso-margin-top-alt:3.75pt;margin-right:0in;margin-bottom:3.75pt;margin-left:0in\">\r\n<span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">******************************************************************************************</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Bonjour Etienne,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"margin-bottom:12.0pt\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">J’espére que vous allez bien.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Je reviens vers vous concernant le script corrigé que je vous ai transmis hier.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Avez-vous pu le tester de votre côté et est-ce que tout fonctionne désormais correctement pour le téléchargement de la dataset freight ?<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">N’hésitez pas à me dire si vous rencontrez encore des soucis, je reste disponible pour vous aider.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Cordialement,<o:p></o:p></span></p>\r\n<div>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background:white;border-collapse:collapse\">\r\n<tbody>\r\n<tr style=\"height:31.0pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<b><span style=\"color:#1F497D;mso-ligatures:standardcontextual\">Saber Khalfallah</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">Customer Support</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"top\" style=\"width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" align=\"right\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual\"><a href=\"mailto:saber.khalfallah@dnext.io\"><span style=\"color:blue\">saber.khalfallah@dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n<tr style=\"height:64.5pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<span style=\"font-size:11.0pt;color:#242424\"><img border=\"0\" width=\"73\" height=\"80\" style=\"width:.7583in;height:.8333in\" id=\"Picture_x0020_2\" src=\"cid:image001.png@01DC345B.F6B5A540\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"bottom\" style=\"width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">DNEXT INTELLIGENCE SA\r\n</span></b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"mailto:info@dnext.io\"><span style=\"color:blue\">info@dnext.io</span></a></span><span style=\"font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual\">&nbsp;</span><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">|\r\n</span><span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style=\"color:blue\">www.dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div style=\"border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt\">\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;\r\n<br>\r\n<b>Sent:</b> Monday, September 29, 2025 13:29<br>\r\n<b>To:</b> Etienne Cornette &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Bonjour Etienne<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><br>\r\nil y’avait quelques fautes des syntax que j’ai corrigé et j’ai testé le script , sa fonctionnait chez moi sans soucis .<br>\r\nvous trouverez ci-dessous le script corrigé :<o:p></o:p></span></p>\r\n<div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Quote\r\n<br>\r\n# Load required libraries <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">library(httr)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">library(jsonlite)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">library(readr)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Function to login to API and get token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">connect &lt;- function(email, pwd, env) {\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# email: email used to connect to your dnext environment\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# pwd: password\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV'\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Construct the URL\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>, env)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Create the payload\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;payload &lt;- toJSON(list(\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;email = email,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;password = pwd,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;organization = env\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;), auto_unbox = TRUE)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Set the headers\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json')\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Send the POST request\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Parse the response and extract the token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;token &lt;- content(response)$token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(token)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">}\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Call the connect function with your credentials\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">token &lt;- connect(<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>, &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">token<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(success)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Function to download dataset<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">download_dataset &lt;- function(code, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;if (data_ready) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(df)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Example usage<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"># Debug: Print dataset preview if successful<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">if (!is.null(df)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(head(df))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">} else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">}<br>\r\n<br>\r\nUnquote<o:p></o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background:white;border-collapse:collapse\">\r\n<tbody>\r\n<tr style=\"height:31.0pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<b><span style=\"color:#1F497D;mso-ligatures:standardcontextual\">Saber Khalfallah</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">Customer Support</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"top\" style=\"width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" align=\"right\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual\"><a href=\"mailto:saber.khalfallah@dnext.io\"><span style=\"color:blue\">saber.khalfallah@dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n<tr style=\"height:64.5pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<span style=\"font-size:11.0pt;color:#242424\"><img border=\"0\" width=\"73\" height=\"80\" style=\"width:.7583in;height:.8333in\" id=\"_x0000_i1027\" src=\"cid:image001.png@01DC345B.F6B5A540\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"bottom\" style=\"width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">DNEXT INTELLIGENCE SA\r\n</span></b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"mailto:info@dnext.io\"><span style=\"color:blue\">info@dnext.io</span></a></span><span style=\"font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual\">&nbsp;</span><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">|\r\n</span><span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style=\"color:blue\">www.dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div style=\"border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt\">\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;\r\n<br>\r\n<b>Sent:</b> Monday, September 29, 2025 13:12<br>\r\n<b>To:</b> Etienne Cornette &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br>\r\n<b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Bonjour Etienne,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Merci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Cordialement<o:p></o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" style=\"background:white;border-collapse:collapse\">\r\n<tbody>\r\n<tr style=\"height:31.0pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<b><span style=\"color:#1F497D;mso-ligatures:standardcontextual\">Saber Khalfallah</span></b><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">Customer Support</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"top\" style=\"width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt\">\r\n<p class=\"MsoNormal\" align=\"right\" style=\"margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"font-size:9.0pt;color:#0563C1;mso-ligatures:standardcontextual\"><a href=\"mailto:saber.khalfallah@dnext.io\"><span style=\"color:blue\">saber.khalfallah@dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n<tr style=\"height:64.5pt\">\r\n<td width=\"193\" valign=\"top\" style=\"width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt\">\r\n<span style=\"font-size:11.0pt;color:#242424\"><img border=\"0\" width=\"73\" height=\"80\" style=\"width:.7583in;height:.8333in\" id=\"x_x_Image_x0020_1\" src=\"cid:image001.png@01DC345B.F6B5A540\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n<td width=\"445\" valign=\"bottom\" style=\"width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt\">\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"center\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt\">\r\n<span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">DNEXT INTELLIGENCE SA\r\n</span></b><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\" align=\"right\" style=\"mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt\">\r\n<span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"mailto:info@dnext.io\"><span style=\"color:blue\">info@dnext.io</span></a></span><span style=\"font-size:9.0pt;color:#242424;mso-ligatures:standardcontextual\">&nbsp;</span><span style=\"font-size:9.0pt;color:#1F497D;mso-ligatures:standardcontextual\">|\r\n</span><span style=\"font-size:9.0pt;color:blue;mso-ligatures:standardcontextual\"><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style=\"color:blue\">www.dnext.io</span></a></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<div>\r\n<div style=\"border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in\">\r\n<p class=\"MsoNormal\"><b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\">From:</span></b><span style=\"font-size:11.0pt;font-family:&quot;Calibri&quot;,sans-serif\"> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;\r\n<br>\r\n<b>Sent:</b> Monday, September 29, 2025 12:46<br>\r\n<b>To:</b> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;<br>\r\n<b>Subject:</b> Problème pour DL freight database<o:p></o:p></span></p>\r\n</div>\r\n</div>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Bonjour Saber,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">J’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Mon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Peux tu m’aider stp&nbsp;?\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">Quote&nbsp;:<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Load required libraries\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(httr)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(jsonlite)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">library(readr)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Function to login to API and get token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">connect &lt;- function(email, pwd, env) {\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# email: email used to connect to your dnext environment\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# pwd: password\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV'\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Construct the URL\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;</span><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>,\r\n env) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;</span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Create the payload\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;payload &lt;- toJSON(list(\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;email = email,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;password = pwd,\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;organization = env\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;), auto_unbox = TRUE)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Set the headers\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json')\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Send the POST request\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Parse the response and extract the token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;token &lt;- content(response)$token\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(token)\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Call the connect function with your credentials\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">token &lt;- connect(</span><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><a href=\"mailto:e.cornette@saftco.ch\"><span lang=\"EN-US\">e.cornette@saftco.ch</span></a></span><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">,\r\n &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">token<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(success)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Function to download dataset<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">download_dataset &lt;- function(code, token) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; )<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;if (data_ready) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; } else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; }<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp;&nbsp;return(df)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Example usage<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"># Debug: Print dataset preview if successful<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">if (!is.null(df)) {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(head(df))<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">} else {<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\">}<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:11.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Best regards,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<p class=\"MsoNormal\"><b><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Etienne Cornette<o:p></o:p></span></b></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Grains Trader<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">==============<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">SAFTCO SA\r\n<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span lang=\"FR\" style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">Rue du Mont-Blanc 3,<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\">1201 GENEVA – CH<o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><img border=\"0\" width=\"160\" height=\"121\" style=\"width:1.6666in;height:1.2583in\" id=\"Picture_x0020_1\" src=\"cid:image002.png@01DC345B.F6B5A540\"></span><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p></o:p></span></p>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt;mso-ligatures:standardcontextual\"><o:p>&nbsp;</o:p></span></p>\r\n<table class=\"MsoNormalTable\" border=\"0\" cellspacing=\"3\" cellpadding=\"0\" width=\"100%\" style=\"width:100.0%\">\r\n<tbody>\r\n<tr>\r\n<td style=\"background:white;padding:.75pt .75pt .75pt .75pt\">\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">------------------------------DISCLAIMER------------------------------------</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque\r\n forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce\r\n message s'avérait modifié ou falsifié.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n<p><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:#0070C0\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this\r\n message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible\r\n to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style=\"font-size:10.0pt;font-family:&quot;Courier New&quot;;color:black\"><o:p></o:p></span></p>\r\n</td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p class=\"MsoNormal\"><span style=\"font-size:12.0pt\"><o:p>&nbsp;</o:p></span></p>\r\n</div>\r\n</div>\r\n</div>\r\n</body>\r\n</html>\r\n\r\n<table width=\"100%\"><tr><td bgcolor=\"#ffffff\"><font color=\"#000000\"><pre><p><span style=\"color: rgb(0, 112, 192);\">------------------------------DISCLAIMER------------------------------------</span></p><p><span style=\"color: rgb(0, 112, 192);\">-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span></p><p><span style=\"color: rgb(0, 112, 192);\">-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span></p></pre></font></td></tr></table>",
      "conversation_id": "EA341D1AB7064740B3085892A4F20065",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD4900030A5BAC920000",
      "size": 173684,
      "has_attachments": true,
      "attachments": [],
      "message_id": "711bab8049c245f5a7c710e50d1f9254@saftco.ch",
      "in_reply_to": "ZR3P278MB1323FD93A42F23A87D6A7493F81AA@ZR3P278MB1323.CHEP278.PROD.OUTLOOK.COM",
      "references": "<59a2080543d34b4fbf24644843f15c8e@saftco.ch>\r\n <GV0P278MB1320142AF7EB26FB16C100F1F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>\r\n <GV0P278MB1320ED4DB163DBAF677C9C83F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>\r\n <ZR3P278MB1323FD93A42F23A87D6A7493F81AA@ZR3P278MB1323.CHEP278.PROD.OUTLOOK.COM>"
    },
    {
      "subject": "RE: Problème pour DL freight database",
      "from": "/O=EXCHANGELABS/OU=EXCHANGE ADMINISTRATIVE GROUP (FYDIBOHF23SPDLT)/CN=RECIPIENTS/CN=EC49082C17FD4A35889594A9C7ADF53D-30DE44D7-0A",
      "from_name": "Saber Khalfallah",
      "to": "Etienne Cornette",
      "cc": "Support Dnext",
      "received_time": "2025-09-30 11:26:57.764000+00:00",
      "sent_time": "2025-09-30 11:26:52+00:00",
      "body_text": "Bonjour Etienne,\r\n\r\n \r\n\r\nJ’espére que vous allez bien.\r\n\r\n\r\n\r\nJe reviens vers vous concernant le script corrigé que je vous ai transmis hier.\r\n\r\n \r\n\r\nAvez-vous pu le tester de votre côté et est-ce que tout fonctionne désormais correctement pour le téléchargement de la dataset freight ?\r\n\r\n \r\n\r\nN’hésitez pas à me dire si vous rencontrez encore des soucis, je reste disponible pour vous aider.\r\n\r\n \r\n\r\nCordialement,\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io> \r\nSent: Monday, September 29, 2025 13:29\r\nTo: Etienne Cornette <e.cornette@saftco.ch>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Etienne\r\n\r\n\r\nil y’avait quelques fautes des syntax que j’ai corrigé et j’ai testé le script , sa fonctionnait chez moi sans soucis .\r\nvous trouverez ci-dessous le script corrigé :\r\n\r\nQuote \r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\nUnquote\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> > \r\nSent: Monday, September 29, 2025 13:12\r\nTo: Etienne Cornette <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> >\r\nCc: Support Dnext <support@dnext.io <mailto:support@dnext.io> >\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Etienne,\r\n\r\n \r\n\r\nMerci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.\r\n\r\n \r\n\r\nCordialement\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> > \r\nSent: Monday, September 29, 2025 12:46\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> >\r\nSubject: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Saber,\r\n\r\n \r\n\r\nJ’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.\r\n\r\n \r\n\r\nMon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.\r\n\r\n \r\n\r\nPeux tu m’aider stp ? \r\n\r\n \r\n\r\n \r\n\r\nQuote :\r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><meta name=Generator content=\"Microsoft Word 15 (filtered medium)\"><!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:12.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tmso-ligatures:standardcontextual;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle21\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style></head><body lang=EN-US link=\"#467886\" vlink=\"#96607D\" style='word-wrap:break-word'><div class=WordSection1><p class=MsoNormal>Bonjour Etienne,<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>J&#8217;espére que vous allez bien.<br><br><o:p></o:p></p><p class=MsoNormal>Je reviens vers vous concernant le script corrigé que je vous ai transmis hier.<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Avez-vous pu le tester de votre côté et est-ce que tout fonctionne désormais correctement pour le téléchargement de la dataset freight ?<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>N&#8217;hésitez pas à me dire si vous rencontrez encore des soucis, je reste disponible pour vous aider.<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Cordialement,<o:p></o:p></p><div><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='font-size:10.0pt;color:#1F497D'>Saber Khalfallah</span></b><o:p></o:p></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>Customer Support</span><o:p></o:p></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><o:p></o:p></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424;mso-ligatures:none'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"_x0000_i1028\" src=\"cid:image001.png@01DC31FD.1D9D7EA0\"></span><o:p></o:p></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><o:p></o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D'>| </span><span style='font-size:9.0pt;color:blue'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><o:p></o:p></p></td></tr></table><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div style='border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt'><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt; <br><b>Sent:</b> Monday, September 29, 2025 13:29<br><b>To:</b> Etienne Cornette &lt;e.cornette@saftco.ch&gt;<br><b>Cc:</b> Support Dnext &lt;support@dnext.io&gt;<br><b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Bonjour Etienne<o:p></o:p></p><p class=MsoNormal><br>il y&#8217;avait quelques fautes des syntax que j&#8217;ai corrigé et j&#8217;ai testé le script , sa fonctionnait chez moi sans soucis .<br>vous trouverez ci-dessous le script corrigé :<o:p></o:p></p><div><p class=MsoNormal>Quote <br># Load required libraries <o:p></o:p></p><p class=MsoNormal>library(httr) <o:p></o:p></p><p class=MsoNormal>library(jsonlite)<o:p></o:p></p><p class=MsoNormal>library(readr)<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Function to login to API and get token <o:p></o:p></p><p class=MsoNormal>connect &lt;- function(email, pwd, env) { <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# email: email used to connect to your dnext environment <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# pwd: password <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV' <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# Construct the URL <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>, env) <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# Create the payload <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;payload &lt;- toJSON(list( <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;email = email, <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;password = pwd, <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;organization = env <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;), auto_unbox = TRUE) <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# Set the headers <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json') <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# Send the POST request <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload) <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# Parse the response and extract the token <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;token &lt;- content(response)$token <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;return(token) <o:p></o:p></p><p class=MsoNormal>} <o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Call the connect function with your credentials <o:p></o:p></p><p class=MsoNormal>token &lt;- connect(<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>, &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></p><p class=MsoNormal>token<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>get_task_status &lt;- function(task_id, token) {<o:p></o:p></p><p class=MsoNormal>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></p><p class=MsoNormal>&nbsp; )<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></p><p class=MsoNormal>&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></p><p class=MsoNormal>&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; })<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; }<o:p></o:p></p><p class=MsoNormal>&nbsp; }<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;return(success)<o:p></o:p></p><p class=MsoNormal>}<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Function to download dataset<o:p></o:p></p><p class=MsoNormal>download_dataset &lt;- function(code, token) {<o:p></o:p></p><p class=MsoNormal>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></p><p class=MsoNormal>&nbsp; )<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></p><p class=MsoNormal>&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></p><p class=MsoNormal>&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></p><p class=MsoNormal>&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></p><p class=MsoNormal>&nbsp; }<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></p><p class=MsoNormal>&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;if (data_ready) {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; }<o:p></o:p></p><p class=MsoNormal>&nbsp; } else {<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></p><p class=MsoNormal>&nbsp; }<o:p></o:p></p><p class=MsoNormal>&nbsp; <o:p></o:p></p><p class=MsoNormal>&nbsp;&nbsp;return(df)<o:p></o:p></p><p class=MsoNormal>}<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Example usage<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></p><p class=MsoNormal>df &lt;- download_dataset(dataset_code, token)<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Debug: Print dataset preview if successful<o:p></o:p></p><p class=MsoNormal>if (!is.null(df)) {<o:p></o:p></p><p class=MsoNormal>&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></p><p class=MsoNormal>&nbsp; print(head(df))<o:p></o:p></p><p class=MsoNormal>} else {<o:p></o:p></p><p class=MsoNormal>&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></p><p class=MsoNormal>}<br><br>Unquote<o:p></o:p></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='font-size:10.0pt;color:#1F497D'>Saber Khalfallah</span></b><o:p></o:p></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>Customer Support</span><o:p></o:p></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><o:p></o:p></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424;mso-ligatures:none'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"_x0000_i1027\" src=\"cid:image001.png@01DC31FD.1D9D7EA0\"></span><o:p></o:p></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><o:p></o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D'>| </span><span style='font-size:9.0pt;color:blue'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><o:p></o:p></p></td></tr></table><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div style='border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt'><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt; <br><b>Sent:</b> Monday, September 29, 2025 13:12<br><b>To:</b> Etienne Cornette &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt;<br><b>Cc:</b> Support Dnext &lt;<a href=\"mailto:support@dnext.io\">support@dnext.io</a>&gt;<br><b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Bonjour Etienne,<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Merci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><p class=MsoNormal>Cordialement<o:p></o:p></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='font-size:10.0pt;color:#1F497D'>Saber Khalfallah</span></b><o:p></o:p></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>Customer Support</span><o:p></o:p></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><o:p></o:p></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424;mso-ligatures:none'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"x_x_Image_x0020_1\" src=\"cid:image001.png@01DC31FD.1D9D7EA0\"></span><o:p></o:p></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><o:p></o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D'>| </span><span style='font-size:9.0pt;color:blue'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><o:p></o:p></p></td></tr></table><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt; <br><b>Sent:</b> Monday, September 29, 2025 12:46<br><b>To:</b> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;<br><b>Subject:</b> Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Bonjour Saber,<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>J&#8217;espère que tu vas bien. Je t&#8217;écris car je n&#8217;arrive pas à DL la databaase freight à partir de R.<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Mon ordinateur mouline dans le vide et je n&#8217;arrive pas à récupérer le dataframe.<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Peux tu m&#8217;aider stp&nbsp;? <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Quote&nbsp;:<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Load required libraries <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(httr) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(jsonlite)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(readr)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Function to login to API and get token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>connect &lt;- function(email, pwd, env) { <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# email: email used to connect to your dnext environment <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# pwd: password <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV' <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Construct the URL <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;</span><span lang=FR style='font-size:11.0pt'>url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>, env) <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>&nbsp;&nbsp;</span><span style='font-size:11.0pt'># Create the payload <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;payload &lt;- toJSON(list( <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;email = email, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;password = pwd, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;organization = env <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;), auto_unbox = TRUE) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Set the headers <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json') <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Send the POST request <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Parse the response and extract the token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;token &lt;- content(response)$token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(token) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>} <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Call the connect function with your credentials <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>token &lt;- connect(</span><span lang=FR style='font-size:11.0pt'><a href=\"mailto:e.cornette@saftco.ch\"><span lang=EN-US>e.cornette@saftco.ch</span></a></span><span style='font-size:11.0pt'>, &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>token<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(success)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Function to download dataset<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>download_dataset &lt;- function(code, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;if (data_ready) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(df)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Example usage<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Debug: Print dataset preview if successful<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>if (!is.null(df)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(head(df))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>} else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR>Best regards,<o:p></o:p></span></p><p class=MsoNormal><span lang=FR><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b><span lang=FR>Etienne Cornette<o:p></o:p></span></b></p><p class=MsoNormal><span lang=FR>Grains Trader<o:p></o:p></span></p><p class=MsoNormal><span lang=FR>==============<o:p></o:p></span></p><p class=MsoNormal><span lang=FR>SAFTCO SA <o:p></o:p></span></p><p class=MsoNormal><span lang=FR>Rue du Mont-Blanc 3,<o:p></o:p></span></p><p class=MsoNormal>1201 GENEVA &#8211; CH<o:p></o:p></p><p class=MsoNormal><span style='mso-ligatures:none'><img border=0 width=160 height=121 style='width:1.6666in;height:1.2583in' id=\"Picture_x0020_1\" src=\"cid:image002.png@01DC31FD.1D9D7EA0\"></span><o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>------------------------------DISCLAIMER------------------------------------</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='mso-ligatures:none'><o:p>&nbsp;</o:p></span></p></div></div></div></body></html>",
      "conversation_id": "EA341D1AB7064740B3085892A4F20065",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD490003090652510000",
      "size": 120988,
      "has_attachments": true,
      "attachments": [],
      "message_id": "ZR3P278MB1323FD93A42F23A87D6A7493F81AA@ZR3P278MB1323.CHEP278.PROD.OUTLOOK.COM",
      "in_reply_to": "GV0P278MB1320ED4DB163DBAF677C9C83F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "references": "<59a2080543d34b4fbf24644843f15c8e@saftco.ch>\r\n <GV0P278MB1320142AF7EB26FB16C100F1F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>\r\n <GV0P278MB1320ED4DB163DBAF677C9C83F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>"
    },
    {
      "subject": "RE: Problème pour DL freight database",
      "from": "/O=EXCHANGELABS/OU=EXCHANGE ADMINISTRATIVE GROUP (FYDIBOHF23SPDLT)/CN=RECIPIENTS/CN=EC49082C17FD4A35889594A9C7ADF53D-30DE44D7-0A",
      "from_name": "Saber Khalfallah",
      "to": "Etienne Cornette",
      "cc": "Support Dnext",
      "received_time": "2025-09-29 13:29:22.175000+00:00",
      "sent_time": "2025-09-29 13:29:18+00:00",
      "body_text": "Bonjour Etienne\r\n\r\n\r\nil y’avait quelques fautes des syntax que j’ai corrigé et j’ai testé le script , sa fonctionnait chez moi sans soucis .\r\nvous trouverez ci-dessous le script corrigé :\r\n\r\nQuote \r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\nUnquote\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Saber Khalfallah <saber.khalfallah@dnext.io> \r\nSent: Monday, September 29, 2025 13:12\r\nTo: Etienne Cornette <e.cornette@saftco.ch>\r\nCc: Support Dnext <support@dnext.io>\r\nSubject: RE: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Etienne,\r\n\r\n \r\n\r\nMerci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.\r\n\r\n \r\n\r\nCordialement\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> > \r\nSent: Monday, September 29, 2025 12:46\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> >\r\nSubject: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Saber,\r\n\r\n \r\n\r\nJ’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.\r\n\r\n \r\n\r\nMon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.\r\n\r\n \r\n\r\nPeux tu m’aider stp ? \r\n\r\n \r\n\r\n \r\n\r\nQuote :\r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><meta name=Generator content=\"Microsoft Word 15 (filtered medium)\"><!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:12.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tmso-ligatures:standardcontextual;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle21\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style></head><body lang=EN-US link=\"#467886\" vlink=\"#96607D\" style='word-wrap:break-word'><div class=WordSection1><p class=MsoNormal>Bonjour Etienne<o:p></o:p></p><p class=MsoNormal><br>il y&#8217;avait quelques fautes des syntax que j&#8217;ai corrigé et j&#8217;ai testé le script , sa fonctionnait chez moi sans soucis .<br>vous trouverez ci-dessous le script corrigé :<o:p></o:p></p><div><p class=MsoNormal>Quote <br># Load required libraries <o:p></o:p></p><p class=MsoNormal>library(httr) <o:p></o:p></p><p class=MsoNormal>library(jsonlite)<o:p></o:p></p><p class=MsoNormal>library(readr)<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Function to login to API and get token <o:p></o:p></p><p class=MsoNormal>connect &lt;- function(email, pwd, env) { <o:p></o:p></p><p class=MsoNormal>  # email: email used to connect to your dnext environment <o:p></o:p></p><p class=MsoNormal>  # pwd: password <o:p></o:p></p><p class=MsoNormal>  # env: name of your environment, first part in your dnext URL before the dot <o:p></o:p></p><p class=MsoNormal>  # Example: ENV.dnext.io -&gt; env = 'ENV' <o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  # Construct the URL <o:p></o:p></p><p class=MsoNormal>  url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>, env) <o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  # Create the payload <o:p></o:p></p><p class=MsoNormal>  payload &lt;- toJSON(list( <o:p></o:p></p><p class=MsoNormal>    email = email, <o:p></o:p></p><p class=MsoNormal>    password = pwd, <o:p></o:p></p><p class=MsoNormal>    organization = env <o:p></o:p></p><p class=MsoNormal>  ), auto_unbox = TRUE) <o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  # Set the headers <o:p></o:p></p><p class=MsoNormal>  headers &lt;- add_headers('Content-Type' = 'application/json') <o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  # Send the POST request <o:p></o:p></p><p class=MsoNormal>  response &lt;- POST(url, headers, body = payload) <o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  # Parse the response and extract the token <o:p></o:p></p><p class=MsoNormal>  token &lt;- content(response)$token <o:p></o:p></p><p class=MsoNormal>  return(token) <o:p></o:p></p><p class=MsoNormal>} <o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Call the connect function with your credentials <o:p></o:p></p><p class=MsoNormal>token &lt;- connect(<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>, &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></p><p class=MsoNormal>token<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>get_task_status &lt;- function(task_id, token) {<o:p></o:p></p><p class=MsoNormal>  my_headers &lt;- add_headers(<o:p></o:p></p><p class=MsoNormal>    Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></p><p class=MsoNormal>    `Content-Type` = &quot;application/json&quot;<o:p></o:p></p><p class=MsoNormal>  )<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  success &lt;- FALSE<o:p></o:p></p><p class=MsoNormal>  wait_time &lt;- 2  # Initial wait time in seconds<o:p></o:p></p><p class=MsoNormal>  max_wait_time &lt;- 120  # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></p><p class=MsoNormal>    Sys.sleep(wait_time)  # Wait before checking status<o:p></o:p></p><p class=MsoNormal>    <o:p></o:p></p><p class=MsoNormal>    status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></p><p class=MsoNormal>    status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></p><p class=MsoNormal>    print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></p><p class=MsoNormal>    <o:p></o:p></p><p class=MsoNormal>    tryCatch({<o:p></o:p></p><p class=MsoNormal>      status_json &lt;- fromJSON(status_text)<o:p></o:p></p><p class=MsoNormal>      print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></p><p class=MsoNormal>      <o:p></o:p></p><p class=MsoNormal>      if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></p><p class=MsoNormal>        success &lt;- TRUE<o:p></o:p></p><p class=MsoNormal>      } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></p><p class=MsoNormal>        print(&quot;Task failed.&quot;)<o:p></o:p></p><p class=MsoNormal>        break  # Exit the loop if the task has failed<o:p></o:p></p><p class=MsoNormal>      }<o:p></o:p></p><p class=MsoNormal>    }, error = function(e) {<o:p></o:p></p><p class=MsoNormal>      print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></p><p class=MsoNormal>    })<o:p></o:p></p><p class=MsoNormal>    <o:p></o:p></p><p class=MsoNormal>    if (!success) {<o:p></o:p></p><p class=MsoNormal>      wait_time &lt;- wait_time * 2  # Exponential backoff<o:p></o:p></p><p class=MsoNormal>    }<o:p></o:p></p><p class=MsoNormal>  }<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  return(success)<o:p></o:p></p><p class=MsoNormal>}<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Function to download dataset<o:p></o:p></p><p class=MsoNormal>download_dataset &lt;- function(code, token) {<o:p></o:p></p><p class=MsoNormal>  my_headers &lt;- add_headers(<o:p></o:p></p><p class=MsoNormal>    Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></p><p class=MsoNormal>    `Content-Type` = &quot;application/json&quot;<o:p></o:p></p><p class=MsoNormal>  )<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></p><p class=MsoNormal>  res &lt;- POST(dl_url, my_headers)<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  # Debug: Print the raw API response<o:p></o:p></p><p class=MsoNormal>  print(&quot;Download request response:&quot;)<o:p></o:p></p><p class=MsoNormal>  print(content(res, as = &quot;text&quot;))<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  if (is.null(res_json$task$id)) {<o:p></o:p></p><p class=MsoNormal>    stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></p><p class=MsoNormal>  }<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  task_id &lt;- res_json$task$id<o:p></o:p></p><p class=MsoNormal>  data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  if (data_ready) {<o:p></o:p></p><p class=MsoNormal>    if (!is.null(res_json$result$url)) {<o:p></o:p></p><p class=MsoNormal>      data_url &lt;- res_json$result$url<o:p></o:p></p><p class=MsoNormal>      data_resp &lt;- GET(data_url)<o:p></o:p></p><p class=MsoNormal>      <o:p></o:p></p><p class=MsoNormal>      # Debug: Print response status code<o:p></o:p></p><p class=MsoNormal>      print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></p><p class=MsoNormal>      <o:p></o:p></p><p class=MsoNormal>      if (data_resp$status_code == 200) {<o:p></o:p></p><p class=MsoNormal>        df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></p><p class=MsoNormal>      } else {<o:p></o:p></p><p class=MsoNormal>        stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></p><p class=MsoNormal>      }<o:p></o:p></p><p class=MsoNormal>    } else {<o:p></o:p></p><p class=MsoNormal>      stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></p><p class=MsoNormal>    }<o:p></o:p></p><p class=MsoNormal>  } else {<o:p></o:p></p><p class=MsoNormal>    print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></p><p class=MsoNormal>    df &lt;- NULL<o:p></o:p></p><p class=MsoNormal>  }<o:p></o:p></p><p class=MsoNormal>  <o:p></o:p></p><p class=MsoNormal>  return(df)<o:p></o:p></p><p class=MsoNormal>}<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Example usage<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;  # Replace with your dataset code<o:p></o:p></p><p class=MsoNormal>df &lt;- download_dataset(dataset_code, token)<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal># Debug: Print dataset preview if successful<o:p></o:p></p><p class=MsoNormal>if (!is.null(df)) {<o:p></o:p></p><p class=MsoNormal>  print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></p><p class=MsoNormal>  print(head(df))<o:p></o:p></p><p class=MsoNormal>} else {<o:p></o:p></p><p class=MsoNormal>  print(&quot;No dataset returned.&quot;)<o:p></o:p></p><p class=MsoNormal>}<br><br>Unquote<o:p></o:p></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='font-size:10.0pt;color:#1F497D'>Saber Khalfallah</span></b><o:p></o:p></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>Customer Support</span><o:p></o:p></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><o:p></o:p></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424;mso-ligatures:none'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"_x0000_i1027\" src=\"cid:image001.png@01DC3145.0D5067F0\"></span><o:p></o:p></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><o:p></o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D'>| </span><span style='font-size:9.0pt;color:blue'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><o:p></o:p></p></td></tr></table><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div style='border:none;border-left:solid blue 1.5pt;padding:0in 0in 0in 4.0pt'><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt; <br><b>Sent:</b> Monday, September 29, 2025 13:12<br><b>To:</b> Etienne Cornette &lt;e.cornette@saftco.ch&gt;<br><b>Cc:</b> Support Dnext &lt;support@dnext.io&gt;<br><b>Subject:</b> RE: Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Bonjour Etienne,<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Merci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><p class=MsoNormal>Cordialement<o:p></o:p></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='font-size:10.0pt;color:#1F497D'>Saber Khalfallah</span></b><o:p></o:p></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>Customer Support</span><o:p></o:p></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><o:p></o:p></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424;mso-ligatures:none'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"x_x_Image_x0020_1\" src=\"cid:image001.png@01DC3145.0D5067F0\"></span><o:p></o:p></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><o:p></o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D'>| </span><span style='font-size:9.0pt;color:blue'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><o:p></o:p></p></td></tr></table><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'> Cornette Etienne &lt;<a href=\"mailto:e.cornette@saftco.ch\">e.cornette@saftco.ch</a>&gt; <br><b>Sent:</b> Monday, September 29, 2025 12:46<br><b>To:</b> Saber Khalfallah &lt;<a href=\"mailto:saber.khalfallah@dnext.io\">saber.khalfallah@dnext.io</a>&gt;<br><b>Subject:</b> Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Bonjour Saber,<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>J&#8217;espère que tu vas bien. Je t&#8217;écris car je n&#8217;arrive pas à DL la databaase freight à partir de R.<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Mon ordinateur mouline dans le vide et je n&#8217;arrive pas à récupérer le dataframe.<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Peux tu m&#8217;aider stp&nbsp;? <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Quote&nbsp;:<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Load required libraries <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(httr) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(jsonlite)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(readr)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Function to login to API and get token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>connect &lt;- function(email, pwd, env) { <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# email: email used to connect to your dnext environment <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# pwd: password <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV' <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Construct the URL <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;</span><span lang=FR style='font-size:11.0pt'>url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>, env) <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>&nbsp;&nbsp;</span><span style='font-size:11.0pt'># Create the payload <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;payload &lt;- toJSON(list( <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;email = email, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;password = pwd, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;organization = env <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;), auto_unbox = TRUE) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Set the headers <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json') <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Send the POST request <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Parse the response and extract the token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;token &lt;- content(response)$token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(token) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>} <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Call the connect function with your credentials <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>token &lt;- connect(</span><span lang=FR style='font-size:11.0pt'><a href=\"mailto:e.cornette@saftco.ch\"><span lang=EN-US>e.cornette@saftco.ch</span></a></span><span style='font-size:11.0pt'>, &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>token<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(success)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Function to download dataset<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>download_dataset &lt;- function(code, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;if (data_ready) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(df)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Example usage<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Debug: Print dataset preview if successful<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>if (!is.null(df)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(head(df))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>} else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR>Best regards,<o:p></o:p></span></p><p class=MsoNormal><span lang=FR><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b><span lang=FR>Etienne Cornette<o:p></o:p></span></b></p><p class=MsoNormal><span lang=FR>Grains Trader<o:p></o:p></span></p><p class=MsoNormal><span lang=FR>==============<o:p></o:p></span></p><p class=MsoNormal><span lang=FR>SAFTCO SA <o:p></o:p></span></p><p class=MsoNormal><span lang=FR>Rue du Mont-Blanc 3,<o:p></o:p></span></p><p class=MsoNormal>1201 GENEVA &#8211; CH<o:p></o:p></p><p class=MsoNormal><span style='mso-ligatures:none'><img border=0 width=160 height=121 style='width:1.6666in;height:1.2583in' id=\"Picture_x0020_1\" src=\"cid:image002.png@01DC3145.0D5067F0\"></span><o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>------------------------------DISCLAIMER------------------------------------</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='mso-ligatures:none'><o:p>&nbsp;</o:p></span></p></div></div></body></html>",
      "conversation_id": "EA341D1AB7064740B3085892A4F20065",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD4900030906524B0000",
      "size": 126729,
      "has_attachments": true,
      "attachments": [],
      "message_id": "GV0P278MB1320ED4DB163DBAF677C9C83F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "in_reply_to": "GV0P278MB1320142AF7EB26FB16C100F1F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "references": "<59a2080543d34b4fbf24644843f15c8e@saftco.ch>\r\n <GV0P278MB1320142AF7EB26FB16C100F1F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM>"
    },
    {
      "subject": "RE: Problème pour DL freight database",
      "from": "/O=EXCHANGELABS/OU=EXCHANGE ADMINISTRATIVE GROUP (FYDIBOHF23SPDLT)/CN=RECIPIENTS/CN=EC49082C17FD4A35889594A9C7ADF53D-30DE44D7-0A",
      "from_name": "Saber Khalfallah",
      "to": "Etienne Cornette",
      "cc": "Support Dnext",
      "received_time": "2025-09-29 13:11:50.444000+00:00",
      "sent_time": "2025-09-29 13:11:47+00:00",
      "body_text": "Bonjour Etienne,\r\n\r\n \r\n\r\nMerci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.\r\n\r\n \r\n\r\nCordialement\r\n\r\nSaber Khalfallah\r\n\r\nCustomer Support\r\n\r\n                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> \r\n\r\n\r\n\r\n \r\n\r\n \r\n\r\nDNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin\r\n\r\ninfo@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> \r\n\r\n \r\n\r\n \r\n\r\nFrom: Cornette Etienne <e.cornette@saftco.ch> \r\nSent: Monday, September 29, 2025 12:46\r\nTo: Saber Khalfallah <saber.khalfallah@dnext.io>\r\nSubject: Problème pour DL freight database\r\n\r\n \r\n\r\nBonjour Saber,\r\n\r\n \r\n\r\nJ’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.\r\n\r\n \r\n\r\nMon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.\r\n\r\n \r\n\r\nPeux tu m’aider stp ? \r\n\r\n \r\n\r\n \r\n\r\nQuote :\r\n\r\n \r\n\r\n# Load required libraries \r\n\r\nlibrary(httr) \r\n\r\nlibrary(jsonlite)\r\n\r\nlibrary(readr)\r\n\r\n \r\n\r\n# Function to login to API and get token \r\n\r\nconnect <- function(email, pwd, env) { \r\n\r\n  # email: email used to connect to your dnext environment \r\n\r\n  # pwd: password \r\n\r\n  # env: name of your environment, first part in your dnext URL before the dot \r\n\r\n  # Example: ENV.dnext.io -> env = 'ENV' \r\n\r\n  \r\n\r\n  # Construct the URL \r\n\r\n  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) \r\n\r\n  \r\n\r\n  # Create the payload \r\n\r\n  payload <- toJSON(list( \r\n\r\n    email = email, \r\n\r\n    password = pwd, \r\n\r\n    organization = env \r\n\r\n  ), auto_unbox = TRUE) \r\n\r\n  \r\n\r\n  # Set the headers \r\n\r\n  headers <- add_headers('Content-Type' = 'application/json') \r\n\r\n  \r\n\r\n  # Send the POST request \r\n\r\n  response <- POST(url, headers, body = payload) \r\n\r\n  \r\n\r\n  # Parse the response and extract the token \r\n\r\n  token <- content(response)$token \r\n\r\n  return(token) \r\n\r\n} \r\n\r\n \r\n\r\n# Call the connect function with your credentials \r\n\r\ntoken <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , \"jgyH6564jijliuhçà_mkkjh\", \"saftco\") \r\n\r\ntoken\r\n\r\n \r\n\r\nget_task_status <- function(task_id, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  success <- FALSE\r\n\r\n  wait_time <- 2  # Initial wait time in seconds\r\n\r\n  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)\r\n\r\n  \r\n\r\n  while (!success && wait_time <= max_wait_time) {\r\n\r\n    Sys.sleep(wait_time)  # Wait before checking status\r\n\r\n    \r\n\r\n    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)\r\n\r\n    status_text <- content(status_res, as = \"text\")\r\n\r\n    print(paste(\"Task Status Response:\", status_text))\r\n\r\n    \r\n\r\n    tryCatch({\r\n\r\n      status_json <- fromJSON(status_text)\r\n\r\n      print(paste(\"Task Status:\", status_json$status))\r\n\r\n      \r\n\r\n      if (status_json$status == \"SUCCEEDED\") {\r\n\r\n        success <- TRUE\r\n\r\n      } else if (status_json$status == \"FAILED\") {\r\n\r\n        print(\"Task failed.\")\r\n\r\n        break  # Exit the loop if the task has failed\r\n\r\n      }\r\n\r\n    }, error = function(e) {\r\n\r\n      print(paste(\"Error parsing task status:\", e$message))\r\n\r\n    })\r\n\r\n    \r\n\r\n    if (!success) {\r\n\r\n      wait_time <- wait_time * 2  # Exponential backoff\r\n\r\n    }\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(success)\r\n\r\n}\r\n\r\n \r\n\r\n# Function to download dataset\r\n\r\ndownload_dataset <- function(code, token) {\r\n\r\n  my_headers <- add_headers(\r\n\r\n    Authorization = paste(\"Bearer\", token),\r\n\r\n    `Content-Type` = \"application/json\"\r\n\r\n  )\r\n\r\n  \r\n\r\n  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')\r\n\r\n  res <- POST(dl_url, my_headers)\r\n\r\n  \r\n\r\n  # Debug: Print the raw API response\r\n\r\n  print(\"Download request response:\")\r\n\r\n  print(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  res_json <- fromJSON(content(res, as = \"text\"))\r\n\r\n  \r\n\r\n  if (is.null(res_json$task$id)) {\r\n\r\n    stop(\"Error: Task ID not found in the response.\")\r\n\r\n  }\r\n\r\n  \r\n\r\n  task_id <- res_json$task$id\r\n\r\n  data_ready <- get_task_status(task_id, token)\r\n\r\n  \r\n\r\n  if (data_ready) {\r\n\r\n    if (!is.null(res_json$result$url)) {\r\n\r\n      data_url <- res_json$result$url\r\n\r\n      data_resp <- GET(data_url)\r\n\r\n      \r\n\r\n      # Debug: Print response status code\r\n\r\n      print(paste(\"Download response status code:\", data_resp$status_code))\r\n\r\n      \r\n\r\n      if (data_resp$status_code == 200) {\r\n\r\n        df <- read_csv(content(data_resp, as = \"raw\"), locale = locale(encoding = \"UTF-8\"), show_col_types = FALSE)\r\n\r\n      } else {\r\n\r\n        stop(\"Error: Failed to download dataset.\")\r\n\r\n      }\r\n\r\n    } else {\r\n\r\n      stop(\"Error: Data URL not found.\")\r\n\r\n    }\r\n\r\n  } else {\r\n\r\n    print(\"Task did not succeed. Returning NULL.\")\r\n\r\n    df <- NULL\r\n\r\n  }\r\n\r\n  \r\n\r\n  return(df)\r\n\r\n}\r\n\r\n \r\n\r\n# Example usage\r\n\r\n \r\n\r\ndataset_code <- \"saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909\"  # Replace with your dataset code\r\n\r\ndf <- download_dataset(dataset_code, token)\r\n\r\n \r\n\r\n# Debug: Print dataset preview if successful\r\n\r\nif (!is.null(df)) {\r\n\r\n  print(\"Dataset successfully downloaded:\")\r\n\r\n  print(head(df))\r\n\r\n} else {\r\n\r\n  print(\"No dataset returned.\")\r\n\r\n}\r\n\r\n \r\n\r\nBest regards,\r\n\r\n \r\n\r\nEtienne Cornette\r\n\r\nGrains Trader\r\n\r\n==============\r\n\r\nSAFTCO SA \r\n\r\nRue du Mont-Blanc 3,\r\n\r\n1201 GENEVA – CH\r\n\r\n\r\n\r\n \r\n\r\n------------------------------DISCLAIMER------------------------------------\r\n\r\n-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.\r\n\r\n-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.\r\n\r\n \r\n",
      "body_html": "<html xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" xmlns:m=\"http://schemas.microsoft.com/office/2004/12/omml\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head><meta name=Generator content=\"Microsoft Word 15 (filtered medium)\"><!--[if !mso]><style>v\\:* {behavior:url(#default#VML);}\r\no\\:* {behavior:url(#default#VML);}\r\nw\\:* {behavior:url(#default#VML);}\r\n.shape {behavior:url(#default#VML);}\r\n</style><![endif]--><style><!--\r\n/* Font Definitions */\r\n@font-face\r\n\t{font-family:\"Cambria Math\";\r\n\tpanose-1:2 4 5 3 5 4 6 3 2 4;}\r\n@font-face\r\n\t{font-family:Calibri;\r\n\tpanose-1:2 15 5 2 2 2 4 3 2 4;}\r\n@font-face\r\n\t{font-family:Aptos;}\r\n@font-face\r\n\t{font-family:Consolas;\r\n\tpanose-1:2 11 6 9 2 2 4 3 2 4;}\r\n/* Style Definitions */\r\np.MsoNormal, li.MsoNormal, div.MsoNormal\r\n\t{margin:0in;\r\n\tfont-size:12.0pt;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tmso-ligatures:standardcontextual;}\r\na:link, span.MsoHyperlink\r\n\t{mso-style-priority:99;\r\n\tcolor:#467886;\r\n\ttext-decoration:underline;}\r\nspan.EmailStyle22\r\n\t{mso-style-type:personal-reply;\r\n\tfont-family:\"Aptos\",sans-serif;\r\n\tcolor:windowtext;}\r\n.MsoChpDefault\r\n\t{mso-style-type:export-only;\r\n\tfont-size:10.0pt;\r\n\tmso-ligatures:none;}\r\n@page WordSection1\r\n\t{size:8.5in 11.0in;\r\n\tmargin:1.0in 1.0in 1.0in 1.0in;}\r\ndiv.WordSection1\r\n\t{page:WordSection1;}\r\n--></style></head><body lang=EN-US link=\"#467886\" vlink=\"#96607D\" style='word-wrap:break-word'><div class=WordSection1><p class=MsoNormal>Bonjour Etienne,<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal>Merci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.<o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><p class=MsoNormal>Cordialement<o:p></o:p></p><table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 style='background:white;border-collapse:collapse'><tr style='height:31.0pt'><td width=193 valign=top style='width:144.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal style='margin-top:6.0pt;mso-margin-bottom-alt:auto;line-height:12.6pt'><b><span style='font-size:10.0pt;color:#1F497D'>Saber Khalfallah</span></b><o:p></o:p></p><p class=MsoNormal style='mso-margin-top-alt:auto;margin-bottom:6.0pt;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>Customer Support</span><o:p></o:p></p></td><td width=445 valign=top style='width:333.9pt;border:none;border-top:solid #4A442A 2.25pt;padding:.75pt 5.4pt .75pt 5.4pt;height:31.0pt'><p class=MsoNormal align=right style='margin-top:6.0pt;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:#1F497D'>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style='font-size:9.0pt;color:#0563C1'><a href=\"mailto:saber.khalfallah@dnext.io\"><span style='color:blue'>saber.khalfallah@dnext.io</span></a></span><o:p></o:p></p></td></tr><tr style='height:64.5pt'><td width=193 valign=top style='width:144.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;line-height:12.6pt'><span style='font-size:11.0pt;color:#242424;mso-ligatures:none'><img border=0 width=73 height=80 style='width:.7583in;height:.8333in' id=\"x_x_Image_x0020_1\" src=\"cid:image002.png@01DC3142.9B2F6790\"></span><o:p></o:p></p></td><td width=445 valign=bottom style='width:333.9pt;padding:.75pt 5.4pt .75pt 5.4pt;height:64.5pt'><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=center style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:center;line-height:12.6pt'><o:p>&nbsp;</o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><b><span style='font-size:9.0pt;color:#1F497D'>DNEXT INTELLIGENCE SA </span></b><span style='font-size:9.0pt;color:#1F497D'>| Avenue Louis-Casaï 81 | CH-1216 Cointrin</span><o:p></o:p></p><p class=MsoNormal align=right style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;text-align:right;line-height:12.6pt'><span style='font-size:9.0pt;color:blue'><a href=\"mailto:info@dnext.io\"><span style='color:blue'>info@dnext.io</span></a></span><span style='font-size:9.0pt;color:#242424'>&nbsp;</span><span style='font-size:9.0pt;color:#1F497D'>| </span><span style='font-size:9.0pt;color:blue'><a href=\"http://www.dnext.io/\" target=\"_blank\"><span style='color:blue'>www.dnext.io</span></a></span><o:p></o:p></p></td></tr></table><p class=MsoNormal><o:p>&nbsp;</o:p></p></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><div><div style='border:none;border-top:solid #E1E1E1 1.0pt;padding:3.0pt 0in 0in 0in'><p class=MsoNormal><b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'>From:</span></b><span style='font-size:11.0pt;font-family:\"Calibri\",sans-serif;mso-ligatures:none'> Cornette Etienne &lt;e.cornette@saftco.ch&gt; <br><b>Sent:</b> Monday, September 29, 2025 12:46<br><b>To:</b> Saber Khalfallah &lt;saber.khalfallah@dnext.io&gt;<br><b>Subject:</b> Problème pour DL freight database<o:p></o:p></span></p></div></div><p class=MsoNormal><o:p>&nbsp;</o:p></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Bonjour Saber,<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>J&#8217;espère que tu vas bien. Je t&#8217;écris car je n&#8217;arrive pas à DL la databaase freight à partir de R.<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Mon ordinateur mouline dans le vide et je n&#8217;arrive pas à récupérer le dataframe.<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Peux tu m&#8217;aider stp&nbsp;? <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>Quote&nbsp;:<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Load required libraries <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(httr) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(jsonlite)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>library(readr)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Function to login to API and get token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>connect &lt;- function(email, pwd, env) { <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# email: email used to connect to your dnext environment <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# pwd: password <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# env: name of your environment, first part in your dnext URL before the dot <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Example: ENV.dnext.io -&gt; env = 'ENV' <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Construct the URL <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;</span><span lang=FR style='font-size:11.0pt'>url &lt;- paste0(<a href=\"https://api.dnext.io/v1.0/auth/custom-login?org=\">https://api.dnext.io/v1.0/auth/custom-login?org=</a>, env) <o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>&nbsp;&nbsp;</span><span style='font-size:11.0pt'># Create the payload <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;payload &lt;- toJSON(list( <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;email = email, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;password = pwd, <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;organization = env <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;), auto_unbox = TRUE) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Set the headers <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;headers &lt;- add_headers('Content-Type' = 'application/json') <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Send the POST request <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;response &lt;- POST(url, headers, body = payload) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Parse the response and extract the token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;token &lt;- content(response)$token <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(token) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>} <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Call the connect function with your credentials <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>token &lt;- connect(</span><span lang=FR style='font-size:11.0pt'><a href=\"mailto:e.cornette@saftco.ch\"><span lang=EN-US>e.cornette@saftco.ch</span></a></span><span style='font-size:11.0pt'>, &quot;jgyH6564jijliuhçà_mkkjh&quot;, &quot;saftco&quot;) <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>token<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>get_task_status &lt;- function(task_id, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;success &lt;- FALSE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; wait_time &lt;- 2&nbsp; # Initial wait time in seconds<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; max_wait_time &lt;- 120&nbsp; # Maximum wait time in seconds (e.g., 2 minutes)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;while (!success &amp;&amp; wait_time &lt;= max_wait_time) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Sys.sleep(wait_time)&nbsp; # Wait before checking status<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;status_res &lt;- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; status_text &lt;- content(status_res, as = &quot;text&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status Response:&quot;, status_text))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;tryCatch({<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; status_json &lt;- fromJSON(status_text)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Task Status:&quot;, status_json$status))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (status_json$status == &quot;SUCCEEDED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success &lt;- TRUE<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else if (status_json$status == &quot;FAILED&quot;) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(&quot;Task failed.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break&nbsp; # Exit the loop if the task has failed<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }, error = function(e) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Error parsing task status:&quot;, e$message))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; })<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;if (!success) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wait_time &lt;- wait_time * 2&nbsp; # Exponential backoff<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(success)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Function to download dataset<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>download_dataset &lt;- function(code, token) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; my_headers &lt;- add_headers(<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; Authorization = paste(&quot;Bearer&quot;, token),<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; `Content-Type` = &quot;application/json&quot;<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; )<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;dl_url &lt;- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; res &lt;- POST(dl_url, my_headers)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;# Debug: Print the raw API response<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;Download request response:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;res_json &lt;- fromJSON(content(res, as = &quot;text&quot;))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;if (is.null(res_json$task$id)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; stop(&quot;Error: Task ID not found in the response.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;task_id &lt;- res_json$task$id<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; data_ready &lt;- get_task_status(task_id, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;if (data_ready) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; if (!is.null(res_json$result$url)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_url &lt;- res_json$result$url<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_resp &lt;- GET(data_url)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Debug: Print response status code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print(paste(&quot;Download response status code:&quot;, data_resp$status_code))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (data_resp$status_code == 200) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; df &lt;- read_csv(content(data_resp, as = &quot;raw&quot;), locale = locale(encoding = &quot;UTF-8&quot;), show_col_types = FALSE)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Failed to download dataset.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stop(&quot;Error: Data URL not found.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; } else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; print(&quot;Task did not succeed. Returning NULL.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;&nbsp; df &lt;- NULL<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; }<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; <o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp;&nbsp;return(df)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Example usage<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>dataset_code &lt;- &quot;saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909&quot;&nbsp; # Replace with your dataset code<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>df &lt;- download_dataset(dataset_code, token)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'># Debug: Print dataset preview if successful<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>if (!is.null(df)) {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;Dataset successfully downloaded:&quot;)<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(head(df))<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>} else {<o:p></o:p></span></p><p class=MsoNormal><span style='font-size:11.0pt'>&nbsp; print(&quot;No dataset returned.&quot;)<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'>}<o:p></o:p></span></p><p class=MsoNormal><span lang=FR style='font-size:11.0pt'><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><span lang=FR>Best regards,<o:p></o:p></span></p><p class=MsoNormal><span lang=FR><o:p>&nbsp;</o:p></span></p><p class=MsoNormal><b><span lang=FR>Etienne Cornette<o:p></o:p></span></b></p><p class=MsoNormal><span lang=FR>Grains Trader<o:p></o:p></span></p><p class=MsoNormal><span lang=FR>==============<o:p></o:p></span></p><p class=MsoNormal><span lang=FR>SAFTCO SA <o:p></o:p></span></p><p class=MsoNormal><span lang=FR>Rue du Mont-Blanc 3,<o:p></o:p></span></p><p class=MsoNormal>1201 GENEVA &#8211; CH<o:p></o:p></p><p class=MsoNormal><span style='mso-ligatures:none'><img border=0 width=160 height=121 style='width:1.6666in;height:1.2583in' id=\"Picture_x0020_1\" src=\"cid:image003.png@01DC3142.9B2F6790\"></span><o:p></o:p></p><p class=MsoNormal><o:p>&nbsp;</o:p></p><table class=MsoNormalTable border=0 cellspacing=3 cellpadding=0 width=\"100%\" style='width:100.0%'><tr><td style='background:white;padding:.75pt .75pt .75pt .75pt'><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>------------------------------DISCLAIMER------------------------------------</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p><p><span style='font-size:10.0pt;font-family:\"Courier New\";color:#0070C0'>-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.</span><span style='font-size:10.0pt;font-family:\"Courier New\";color:black'><o:p></o:p></span></p></td></tr></table><p class=MsoNormal><span style='mso-ligatures:none'><o:p>&nbsp;</o:p></span></p></div></body></html>",
      "conversation_id": "EA341D1AB7064740B3085892A4F20065",
      "entry_id": "000000009E3298A6443E984393DE69BAE1D39B3A07008F4B4B7A024B9B439BA456836AE1DD4900000000010C00008F4B4B7A024B9B439BA456836AE1DD490003090652490000",
      "size": 93789,
      "has_attachments": true,
      "attachments": [],
      "message_id": "GV0P278MB1320142AF7EB26FB16C100F1F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM",
      "in_reply_to": "59a2080543d34b4fbf24644843f15c8e@saftco.ch",
      "references": "<59a2080543d34b4fbf24644843f15c8e@saftco.ch>"
    }
  ],
  "subject": "RE: Problème pour DL freight database"
}