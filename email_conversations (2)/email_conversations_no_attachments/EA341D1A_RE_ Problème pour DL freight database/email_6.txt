From: Saber Khalfallah </O=EXCHANGELABS/OU=EXCHANGE ADMINISTRATIVE GROUP (FYDIBOHF23SPDLT)/CN=RECIPIENTS/CN=EC49082C17FD4A35889594A9C7ADF53D-30DE44D7-0A>
To: Etienne Cornette
Date: 2025-09-29 13:11:50.444000+00:00
Subject: RE: Problème pour DL freight database
Message-ID: GV0P278MB1320142AF7EB26FB16C100F1F81BA@GV0P278MB1320.CHEP278.PROD.OUTLOOK.COM
In-Reply-To: 59a2080543d34b4fbf24644843f15c8e@saftco.ch

================================================================================

Bonjour Etienne,

 

Merci pour votre message ! Je suis en train de vérifier ça tout de suite, je vous tiendrai au courant rapidement.

 

Cordialement

Saber Khalfallah

Customer Support

                                                                                                     saber.khalfallah@dnext.io <mailto:saber.khalfallah@dnext.io> 



 

 

DNEXT INTELLIGENCE SA | Avenue Louis-Casaï 81 | CH-1216 Cointrin

info@dnext.io <mailto:info@dnext.io>  | www.dnext.io <http://www.dnext.io/> 

 

 

From: Cornette Etienne <e.cornette@saftco.ch> 
Sent: Monday, September 29, 2025 12:46
To: Saber Khalfallah <saber.khalfallah@dnext.io>
Subject: Problème pour DL freight database

 

Bonjour Saber,

 

J’espère que tu vas bien. Je t’écris car je n’arrive pas à DL la databaase freight à partir de R.

 

Mon ordinateur mouline dans le vide et je n’arrive pas à récupérer le dataframe.

 

Peux tu m’aider stp ? 

 

 

Quote :

 

# Load required libraries 

library(httr) 

library(jsonlite)

library(readr)

 

# Function to login to API and get token 

connect <- function(email, pwd, env) { 

  # email: email used to connect to your dnext environment 

  # pwd: password 

  # env: name of your environment, first part in your dnext URL before the dot 

  # Example: ENV.dnext.io -> env = 'ENV' 

  

  # Construct the URL 

  url <- paste0(https://api.dnext.io/v1.0/auth/custom-login?org=, env) 

  

  # Create the payload 

  payload <- toJSON(list( 

    email = email, 

    password = pwd, 

    organization = env 

  ), auto_unbox = TRUE) 

  

  # Set the headers 

  headers <- add_headers('Content-Type' = 'application/json') 

  

  # Send the POST request 

  response <- POST(url, headers, body = payload) 

  

  # Parse the response and extract the token 

  token <- content(response)$token 

  return(token) 

} 

 

# Call the connect function with your credentials 

token <- connect(e.cornette@saftco.ch <mailto:e.cornette@saftco.ch> , "jgyH6564jijliuhçà_mkkjh", "saftco") 

token

 

get_task_status <- function(task_id, token) {

  my_headers <- add_headers(

    Authorization = paste("Bearer", token),

    `Content-Type` = "application/json"

  )

  

  success <- FALSE

  wait_time <- 2  # Initial wait time in seconds

  max_wait_time <- 120  # Maximum wait time in seconds (e.g., 2 minutes)

  

  while (!success && wait_time <= max_wait_time) {

    Sys.sleep(wait_time)  # Wait before checking status

    

    status_res <- GET(paste0('https://api.dnext.io/v1.0/tasks/', task_id), my_headers)

    status_text <- content(status_res, as = "text")

    print(paste("Task Status Response:", status_text))

    

    tryCatch({

      status_json <- fromJSON(status_text)

      print(paste("Task Status:", status_json$status))

      

      if (status_json$status == "SUCCEEDED") {

        success <- TRUE

      } else if (status_json$status == "FAILED") {

        print("Task failed.")

        break  # Exit the loop if the task has failed

      }

    }, error = function(e) {

      print(paste("Error parsing task status:", e$message))

    })

    

    if (!success) {

      wait_time <- wait_time * 2  # Exponential backoff

    }

  }

  

  return(success)

}

 

# Function to download dataset

download_dataset <- function(code, token) {

  my_headers <- add_headers(

    Authorization = paste("Bearer", token),

    `Content-Type` = "application/json"

  )

  

  dl_url <- paste0('https://api.dnext.io/v1.0/data/datasets/', code, '/download')

  res <- POST(dl_url, my_headers)

  

  # Debug: Print the raw API response

  print("Download request response:")

  print(content(res, as = "text"))

  

  res_json <- fromJSON(content(res, as = "text"))

  

  if (is.null(res_json$task$id)) {

    stop("Error: Task ID not found in the response.")

  }

  

  task_id <- res_json$task$id

  data_ready <- get_task_status(task_id, token)

  

  if (data_ready) {

    if (!is.null(res_json$result$url)) {

      data_url <- res_json$result$url

      data_resp <- GET(data_url)

      

      # Debug: Print response status code

      print(paste("Download response status code:", data_resp$status_code))

      

      if (data_resp$status_code == 200) {

        df <- read_csv(content(data_resp, as = "raw"), locale = locale(encoding = "UTF-8"), show_col_types = FALSE)

      } else {

        stop("Error: Failed to download dataset.")

      }

    } else {

      stop("Error: Data URL not found.")

    }

  } else {

    print("Task did not succeed. Returning NULL.")

    df <- NULL

  }

  

  return(df)

}

 

# Example usage

 

dataset_code <- "saftco-6a211b50-3b48-4e90-8f86-47e2e2b81909"  # Replace with your dataset code

df <- download_dataset(dataset_code, token)

 

# Debug: Print dataset preview if successful

if (!is.null(df)) {

  print("Dataset successfully downloaded:")

  print(head(df))

} else {

  print("No dataset returned.")

}

 

Best regards,

 

Etienne Cornette

Grains Trader

==============

SAFTCO SA 

Rue du Mont-Blanc 3,

1201 GENEVA – CH



 

------------------------------DISCLAIMER------------------------------------

-Les informations contenues dans ce document sont de nature confidentielle et à l'usage exclusif des destinataires prévus.Si vous l'avez reçu par erreur, son utilisation sous quelque forme qu'elle soit est strictement interdite. Nous vous remercions dans ce cas de détruire le message et de prendre contact avec son expéditeur. L'intégrité des messages n'étant pas assurée sur Internet, le Groupe OCP ne saurait être tenu responsable si ce message s'avérait modifié ou falsifié.

-The information contained in this message and any attachments hereto are confidential and intended solely for the addressee(s) intended. If you are not the intended addressee of this message, you are hereby notified thatyou have received this document in error. Any review, dissemination, distribution, or copying of this message is prohibited. Please delete it and inform the sender immediately. Thank you for your help. Messages are susceptible to alteration. OCP GROUP shall not be liable for the message if altered,changed or falsified.

 
